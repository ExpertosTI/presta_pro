import{j as e,C as x,f as d,W as q,U as J,B as K,a as Q,b as X}from"./index-d07a4565.js";import{r as j}from"./vendor-8a332d8f.js";import{C as Z}from"./crown-11975964.js";import{C as y,T as _}from"./trending-down-36e32bc6.js";import{T as R}from"./trending-up-aed1c674.js";import{C as ee}from"./clock-0f83d6c6.js";import{A as te}from"./alert-triangle-f3e24c64.js";import{C as L}from"./calendar-da7962d8.js";function oe({loans:D=[],clients:o=[],receipts:v=[],expenses:S=[],showToast:se,onNavigate:a,subscriptionInfo:m,tenantInfo:h}){const[p,H]=j.useState("today"),b=new Date,C=new Date(b.getFullYear(),b.getMonth(),b.getDate()),f=new Date(C);f.setDate(f.getDate()-f.getDay());const V=new Date(b.getFullYear(),b.getMonth(),1),B=()=>{switch(p){case"today":return C;case"week":return f;case"month":return V;default:return new Date(0)}},n=j.useMemo(()=>D.filter(t=>!t.archived&&t.status!=="ARCHIVED"&&t.status!=="COMPLETED"),[D]),M=n.reduce((t,s)=>t+parseFloat(s.amount||0),0),A=n.reduce((t,s)=>t+(s.totalPaid||0),0),U=n.filter(t=>t.status==="ACTIVE").length,W=n.filter(t=>t.status==="PAID").length,G=n.reduce((t,s)=>t+(s.totalInterest||0),0),z=M+G,Y=z-A,E=B(),P=v.filter(t=>new Date(t.date)>=E),T=S.filter(t=>t.date&&new Date(t.date)>=E),g=P.reduce((t,s)=>{const l=parseFloat(s.amount||0),r=parseFloat(s.penaltyAmount||0);return t+l+r},0),$=T.reduce((t,s)=>t+parseFloat(s.amount||0),0),u=g-$,F=P.reduce((t,s)=>t+parseFloat(s.penaltyAmount||0),0),N=j.useMemo(()=>{const t=new Date;return t.setHours(0,0,0,0),n.flatMap(s=>{const l=o.find(r=>r.id===s.clientId);return(s.schedule||[]).filter(r=>r.status!=="PAID"&&new Date(r.date)<t).map(r=>({...r,loanId:s.id,clientName:(l==null?void 0:l.name)||"Sin nombre",clientPhone:l==null?void 0:l.phone,daysOverdue:Math.floor((t-new Date(r.date))/(1e3*60*60*24))}))}).sort((s,l)=>l.daysOverdue-s.daysOverdue)},[n,o]),w=j.useMemo(()=>{const t=new Date;t.setHours(0,0,0,0);const s=new Date(t);return s.setDate(s.getDate()+1),n.flatMap(l=>{const r=o.find(c=>c.id===l.clientId);return(l.schedule||[]).filter(c=>{const O=new Date(c.date);return c.status!=="PAID"&&O>=t&&O<s}).map(c=>({...c,loanId:l.id,clientName:(r==null?void 0:r.name)||"Sin nombre"}))})},[n,o]),I=(v||[]).slice().sort((t,s)=>new Date(s.date)-new Date(t.date)).slice(0,5),k={today:"Hoy",week:"Esta Semana",month:"Este Mes",all:"Todo"},i=j.useMemo(()=>{if(!(h!=null&&h.createdAt)||m!=null&&m.plan&&m.plan!=="FREE")return null;const t=new Date(h.createdAt),s=new Date(t);s.setDate(s.getDate()+30);const r=s-new Date,c=Math.ceil(r/(1e3*60*60*24));return c>0?c:0},[h,m]);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[i!==null&&i<=30&&e.jsxs("div",{className:`rounded-xl p-4 flex items-center gap-4 ${i<=7?"bg-gradient-to-r from-red-500 to-rose-600 text-white":i<=15?"bg-gradient-to-r from-amber-500 to-orange-500 text-white":"bg-gradient-to-r from-blue-500 to-indigo-600 text-white"}`,children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-lg",children:e.jsx(Z,{size:24})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-bold",children:i===0?"¡Tu cuenta expira hoy!":i===1?"¡Tu cuenta expira mañana!":`Tu cuenta expira en ${i} días`}),e.jsx("p",{className:"text-sm opacity-90",children:"Elige un plan para mantener acceso a todas las funciones"})]}),e.jsxs("button",{onClick:()=>a==null?void 0:a("plans"),className:"px-4 py-2 bg-white text-slate-900 rounded-lg font-semibold hover:bg-slate-100 transition-colors flex items-center gap-2",children:["Ver Planes ",e.jsx(y,{size:16})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100",children:"Panel de Control"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Resumen financiero de tu negocio"})]}),e.jsx("div",{className:"flex items-center gap-2 bg-slate-100 dark:bg-slate-800 p-1 rounded-xl",children:Object.entries(k).map(([t,s])=>e.jsx("button",{onClick:()=>H(t),className:`px-3 py-1.5 rounded-lg text-xs font-semibold transition-all ${p===t?"bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-100 shadow":"text-slate-500 dark:text-slate-400 hover:text-slate-700"}`,children:s},t))})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx("button",{onClick:()=>a==null?void 0:a("loans"),className:"text-left w-full group",children:e.jsx(x,{className:"bg-white dark:bg-[#0f172a] border border-blue-200 dark:border-blue-900/50 hover:border-blue-500/50 transition-all group-hover:shadow-blue-900/20 group-hover:shadow-lg",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-[10px] md:text-xs font-bold text-blue-600 dark:text-blue-400 uppercase tracking-widest",children:"Cartera"}),e.jsx("p",{className:"text-sm sm:text-lg md:text-2xl font-black text-slate-800 dark:text-white mt-1",children:d(M)}),e.jsxs("p",{className:"text-[10px] md:text-xs text-slate-500 dark:text-slate-400 mt-1",children:[n.length," préstamos"]})]}),e.jsx("div",{className:"p-2 bg-blue-500/10 rounded-xl text-blue-400 flex-shrink-0",children:e.jsx(q,{size:20})})]})})}),e.jsx("button",{onClick:()=>a==null?void 0:a("cuadre"),className:"text-left w-full group",children:e.jsx(x,{className:"bg-white dark:bg-[#0f172a] border border-emerald-200 dark:border-emerald-900/50 hover:border-emerald-500/50 transition-all group-hover:shadow-emerald-900/20 group-hover:shadow-lg",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-[10px] md:text-xs font-bold text-emerald-600 dark:text-emerald-400 uppercase tracking-widest",children:"Recaudado"}),e.jsx("p",{className:"text-sm sm:text-lg md:text-2xl font-black text-slate-800 dark:text-white mt-1",children:d(A)}),e.jsxs("p",{className:"text-[10px] md:text-xs text-slate-500 dark:text-slate-400 mt-1",children:[W," pagados"]})]}),e.jsx("div",{className:"p-2 bg-emerald-500/10 rounded-xl text-emerald-400 flex-shrink-0",children:e.jsx(R,{size:20})})]})})}),e.jsx("button",{onClick:()=>a==null?void 0:a("routes"),className:"text-left w-full group",children:e.jsx(x,{className:"bg-white dark:bg-[#0f172a] border border-amber-200 dark:border-amber-900/50 hover:border-amber-500/50 transition-all group-hover:shadow-amber-900/20 group-hover:shadow-lg",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-[10px] md:text-xs font-bold text-amber-600 dark:text-amber-400 uppercase tracking-widest",children:"Por Cobrar"}),e.jsx("p",{className:"text-sm sm:text-lg md:text-2xl font-black text-slate-800 dark:text-white mt-1",children:d(Y)}),e.jsxs("p",{className:"text-[10px] md:text-xs text-slate-500 dark:text-slate-400 mt-1",children:[U," activos"]})]}),e.jsx("div",{className:"p-2 bg-amber-500/10 rounded-xl text-amber-400 flex-shrink-0",children:e.jsx(ee,{size:20})})]})})}),e.jsx("button",{onClick:()=>a==null?void 0:a("clients"),className:"text-left w-full group",children:e.jsx(x,{className:"bg-white dark:bg-[#0f172a] border border-violet-200 dark:border-violet-900/50 hover:border-violet-500/50 transition-all group-hover:shadow-violet-900/20 group-hover:shadow-lg",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-[10px] md:text-xs font-bold text-violet-600 dark:text-violet-400 uppercase tracking-widest",children:"Clientes"}),e.jsx("p",{className:"text-sm sm:text-lg md:text-2xl font-black text-slate-800 dark:text-white mt-1",children:o.length}),e.jsx("p",{className:"text-[10px] md:text-xs text-slate-500 dark:text-slate-400 mt-1",children:"Registrados"})]}),e.jsx("div",{className:"p-2 bg-violet-500/10 rounded-xl text-violet-400 flex-shrink-0",children:e.jsx(J,{size:20})})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs(x,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"font-bold text-slate-800 dark:text-slate-100",children:["Ingresos (",k[p],")"]}),e.jsx("span",{className:"text-2xl font-bold text-emerald-600",children:d(g)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"Cuotas cobradas"}),e.jsx("span",{className:"font-semibold text-slate-800 dark:text-slate-200",children:d(g-F)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"Mora cobrada"}),e.jsx("span",{className:"font-semibold text-amber-600",children:d(F)})]}),e.jsx("div",{className:"h-2 bg-slate-100 dark:bg-slate-700 rounded-full overflow-hidden mt-2",children:e.jsx("div",{className:"h-full bg-emerald-500 transition-all",style:{width:`${Math.min(g/(z||1)*100,100)}%`}})})]})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"font-bold text-slate-800 dark:text-slate-100",children:["Gastos (",k[p],")"]}),e.jsx("span",{className:"text-2xl font-bold text-rose-600",children:d($)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"Movimientos"}),e.jsx("span",{className:"font-semibold text-slate-800 dark:text-slate-200",children:T.length})]}),e.jsx("p",{className:"text-xs text-slate-400",children:"Control de gastos operativos"})]})]}),e.jsxs(x,{className:u>=0?"bg-emerald-50 dark:bg-emerald-900/20":"bg-rose-50 dark:bg-rose-900/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"font-bold text-slate-800 dark:text-slate-100",children:["Balance (",k[p],")"]}),e.jsx("span",{className:`text-2xl font-bold ${u>=0?"text-emerald-600":"text-rose-600"}`,children:d(u)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[u>=0?e.jsx(R,{size:16,className:"text-emerald-500"}):e.jsx(_,{size:16,className:"text-rose-500"}),e.jsx("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:u>=0?"Ganancia neta":"Pérdida neta"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(x,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{size:18,className:"text-amber-500"}),e.jsx("h3",{className:"font-bold text-slate-800 dark:text-slate-100",children:"Alertas de Mora"})]}),N.length>0&&e.jsx("span",{className:"px-2 py-1 bg-rose-100 dark:bg-rose-900/30 text-rose-600 text-xs font-bold rounded-full",children:N.length})]}),N.length===0?e.jsxs("div",{className:"flex flex-col items-center py-6 text-center",children:[e.jsx(Q,{size:32,className:"text-emerald-500 mb-2"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Sin cuotas vencidas"})]}):e.jsx("ul",{className:"space-y-2 max-h-48 overflow-y-auto",children:N.slice(0,5).map((t,s)=>e.jsxs("li",{className:"flex items-center justify-between p-2 bg-rose-50 dark:bg-rose-900/20 rounded-lg cursor-pointer hover:bg-rose-100 dark:hover:bg-rose-800/30 transition-colors",onClick:()=>a&&a("loans",{loanId:t.loanId,clientId:t.clientId}),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{size:14,className:"text-rose-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-slate-800 dark:text-slate-200",children:t.clientName}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Cuota #",t.number," • ",t.daysOverdue," días vencida"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-bold text-rose-600",children:d(t.payment)}),e.jsx(y,{size:14,className:"text-slate-400"})]})]},`${t.loanId}-${t.id}-${s}`))})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{size:18,className:"text-blue-500"}),e.jsx("h3",{className:"font-bold text-slate-800 dark:text-slate-100",children:"Cobros de Hoy"})]}),w.length>0&&e.jsx("span",{className:"px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-600 text-xs font-bold rounded-full",children:w.length})]}),w.length===0?e.jsxs("div",{className:"flex flex-col items-center py-6 text-center",children:[e.jsx(L,{size:32,className:"text-slate-300 dark:text-slate-600 mb-2"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Sin cobros programados hoy"})]}):e.jsx("ul",{className:"space-y-2 max-h-48 overflow-y-auto",children:w.map((t,s)=>e.jsxs("li",{className:"flex items-center justify-between p-2 bg-blue-50 dark:bg-blue-900/20 rounded-lg cursor-pointer hover:bg-blue-100 dark:hover:bg-blue-800/30 transition-colors",onClick:()=>a&&a("loans",{loanId:t.loanId,clientId:t.clientId}),children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-slate-800 dark:text-slate-200",children:t.clientName}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Cuota #",t.number]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-bold text-blue-600",children:d(t.payment)}),e.jsx(y,{size:14,className:"text-slate-400"})]})]},`${t.loanId}-${t.id}-${s}`))})]})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-bold text-slate-800 dark:text-slate-100",children:"Últimos Cobros"}),e.jsxs("span",{className:"text-xs text-slate-500",children:[v.length," total"]})]}),I.length===0?e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 text-center py-4",children:"No hay pagos registrados"}):e.jsx("ul",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:I.map(t=>e.jsxs("li",{className:"py-3 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-slate-800 dark:text-slate-200",children:t.clientName}),e.jsxs("p",{className:"text-xs text-slate-500",children:[X(t.date)," • ",t.isPartialPayment?`Abono a Cuota #${t.installmentNumber||"?"}`:`Cuota #${t.installmentNumber||"?"}`]})]}),e.jsx("span",{className:"font-bold text-emerald-600",children:d(parseFloat(t.amount||0)+parseFloat(t.penaltyAmount||0))})]},t.id))})]})]})}export{oe as DashboardView};
