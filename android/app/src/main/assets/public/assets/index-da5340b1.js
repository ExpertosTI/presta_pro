import{j as e,k as W,f as p,U as Ie,b as q,a as $,C as Z,_ as ze}from"./index-d07a4565.js";import{r as c}from"./vendor-8a332d8f.js";import{N as Re,D as Ee}from"./DigitalReceipt-c3acdccc.js";import{P as Te}from"./PaymentConfirmationModal-888311d5.js";import{T as $e}from"./trending-up-aed1c674.js";import{F as Le}from"./filter-ac94b5de.js";import{A as Me}from"./arrow-up-down-59719749.js";import{S as Oe}from"./search-001f2433.js";import{P as Ve}from"./plus-circle-bec9c90c.js";import{P as Se}from"./printer-82ab4f0e.js";import{S as K}from"./sticky-note-bd8db19a.js";import{P as Fe}from"./phone-69323ed2.js";import{C as Ue}from"./clock-0f83d6c6.js";import{X as _e}from"./x-circle-177d4c0c.js";import{A as He}from"./alert-triangle-f3e24c64.js";import"./html2canvas.esm-e0a7d97b.js";import"./printUtils-04a0a819.js";const Be=({size:w=14})=>e.jsx("svg",{width:w,height:w,viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"})}),ue=[{value:"PENDING",label:"Pendiente",color:"slate",icon:Ue},{value:"VISITED",label:"Visitado",color:"blue",icon:$},{value:"NOT_HOME",label:"No estaba",color:"amber",icon:_e},{value:"REFUSED",label:"Rechazó",color:"rose",icon:He},{value:"PAID",label:"Pagó",color:"emerald",icon:$}];function bt({loans:w,clients:g,registerPayment:be,collectors:L,currentRouteLoanIds:I,routeActive:he,toggleLoanInRoute:Q,clearCurrentRoute:pe,startRoute:fe,finishRoute:X,showToast:b,addRouteClosing:J,routeClosings:M,receipts:y,includeFutureInstallments:O,handlePrint:Ge,setPrintReceipt:We,systemSettings:n}){var ce,xe;const[h,ge]=c.useState(""),[je,V]=c.useState(!1),[Y,S]=c.useState(null),[qe,Ne]=c.useState(""),[ee,te]=c.useState(!1);c.useState(!1);const[ve,ae]=c.useState(!1),[F,le]=c.useState(null),[z,ke]=c.useState(""),[U,we]=c.useState("address"),[_,Ze]=c.useState("asc"),[R,ye]=c.useState("ALL"),[A,se]=c.useState({}),[re,de]=c.useState({}),[E,H]=c.useState(null),ne=c.useMemo(()=>{const t=new Set;return g.forEach(a=>{var r,d;if(a.address){const o=(d=(r=a.address.split(",")[0])==null?void 0:r.split(/\d/)[0])==null?void 0:d.trim();o&&o.length>2&&t.add(o)}}),Array.from(t).sort()},[g]),{pendingCollections:Ke,sortedRoute:v,totalToCollect:B,selectedStops:T,collectorTodayTotal:D,collectorTodayCount:G,paidTodayCount:Qe}=c.useMemo(()=>{const t=new Date;t.setHours(0,0,0,0),console.log("[RoutesView] Input - loans:",w==null?void 0:w.length,"clients:",g==null?void 0:g.length,"includeFuture:",O);const a=w.flatMap(l=>{var u,P,k;if(l.status==="ARCHIVED"||l.status==="COMPLETED"||l.archived)return[];const s=g.find(N=>N.id===l.clientId);if(!s)return console.log("[RoutesView] Loan without client:",l.id,"clientId:",l.clientId),[];if(!l.schedule||!Array.isArray(l.schedule))return console.log("[RoutesView] Loan without schedule:",l.id,"schedule:",l.schedule),[];if(h&&s.collectorId!==h)return[];if(R!=="ALL"&&((k=(P=(u=s.address)==null?void 0:u.split(",")[0])==null?void 0:P.split(/\d/)[0])==null?void 0:k.trim())!==R)return[];const i=l.schedule.find(N=>N.status!=="PAID");return i?!O&&new Date(i.date)>t?(console.log("[RoutesView] Loan future date:",l.id,"due:",i.date),[]):[{...i,loanId:l.id,clientId:s.id,clientName:s==null?void 0:s.name,clientAddress:s==null?void 0:s.address,clientPhone:s==null?void 0:s.phone,clientPhotoUrl:s==null?void 0:s.photoUrl,totalDue:i.payment}]:(console.log("[RoutesView] Loan all paid:",l.id),[])});let r=a;if(z.trim()){const l=z.toLowerCase();r=a.filter(s=>{var i,u;return((i=s.clientName)==null?void 0:i.toLowerCase().includes(l))||((u=s.clientAddress)==null?void 0:u.toLowerCase().includes(l))})}const d=[...r].sort((l,s)=>{var P,k,N,me;let i,u;switch(U){case"name":i=((P=l.clientName)==null?void 0:P.toLowerCase())||"",u=((k=s.clientName)==null?void 0:k.toLowerCase())||"";break;case"amount":i=l.payment||0,u=s.payment||0;break;case"number":i=l.number||0,u=s.number||0;break;case"address":default:i=((N=l.clientAddress)==null?void 0:N.toLowerCase())||"",u=((me=s.clientAddress)==null?void 0:me.toLowerCase())||""}return i<u?_==="asc"?-1:1:i>u?_==="asc"?1:-1:0}),o=d.reduce((l,s)=>l+s.payment,0),m=d.filter(l=>I.includes(`${l.loanId}:${l.id}`));let C=0,x=0;if(h&&Array.isArray(y)){const l=new Date;l.setHours(0,0,0,0);const s=new Date(l);s.setDate(s.getDate()+1),y.forEach(i=>{const u=g.find(k=>k.id===i.clientId);if(!u||u.collectorId!==h)return;const P=new Date(i.date);if(P>=l&&P<s){const k=parseFloat(i.amount||0)||0,N=parseFloat(i.penalty||0)||0;C+=k+N,x+=1}})}const De=Object.values(A).filter(l=>l==="PAID").length;return{pendingCollections:a,sortedRoute:d,totalToCollect:o,selectedStops:m,collectorTodayTotal:C,collectorTodayCount:x,paidTodayCount:De}},[w,g,h,I,y,z,U,_,R,A,O]),j=c.useMemo(()=>!h||!Array.isArray(M)?null:M.find(t=>t.collectorId===h)||null,[h,M]),oe=c.useMemo(()=>{if(!j||!Array.isArray(y))return[];const t=new Date(j.date);t.setHours(0,0,0,0);const a=new Date(t);return a.setDate(a.getDate()+1),y.filter(r=>{const d=g.find(m=>m.id===r.clientId);if(!d||d.collectorId!==j.collectorId)return!1;const o=new Date(r.date);return o>=t&&o<a})},[j,y,g]),f=c.useMemo(()=>{const t=v.length,a=Object.values(A).filter(m=>m==="PAID").length,r=Object.values(A).filter(m=>m!=="PENDING"&&m!==void 0).length,d=t>0?Math.round(r/t*100):0,o=t>0?Math.round(a/t*100):0;return{totalStops:t,paidCount:a,visitedCount:r,progressPercent:d,collectionPercent:o}},[v,A]),Ce=()=>{v.forEach(t=>{const a=`${t.loanId}:${t.id}`;I.includes(a)||Q(t.loanId,t.id)}),b==null||b(`${v.length} paradas agregadas a la ruta`,"success")},ie=(t,a)=>{se(r=>({...r,[t]:a}))},Pe=(t,a)=>{de(r=>({...r,[t]:a})),H(null),b==null||b("Nota guardada","success")},Ae=t=>{const a=ue.find(d=>d.value===t);if(!a)return null;const r=a.icon;return e.jsxs("span",{className:`inline-flex items-center gap-1 text-[10px] px-1.5 py-0.5 rounded-full bg-${a.color}-100 dark:bg-${a.color}-900/30 text-${a.color}-700 dark:text-${a.color}-300`,children:[e.jsx(r,{size:10})," ",a.label]})};return e.jsxs("div",{className:"space-y-4 md:space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 bg-indigo-600 text-white p-4 md:p-6 rounded-xl md:rounded-2xl shadow-lg",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg md:text-2xl font-bold flex items-center gap-2",children:[e.jsx(W,{size:20,className:"md:w-6 md:h-6"})," Ruta de Cobros"]}),e.jsx("p",{className:"text-xs md:text-sm opacity-80",children:"Optimización por zona"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl md:text-3xl font-bold",children:v.length}),e.jsx("p",{className:"text-[10px] md:text-xs uppercase tracking-wider",children:"Paradas"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg md:text-xl font-bold text-emerald-300",children:p(B)}),e.jsx("p",{className:"text-[10px] md:text-xs uppercase tracking-wider",children:"Por cobrar"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-xl bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800",children:[e.jsxs("p",{className:"text-xs text-blue-600 dark:text-blue-400 font-semibold flex items-center gap-1",children:[e.jsx(Ie,{size:12})," Progreso"]}),e.jsxs("p",{className:"text-lg font-bold text-blue-800 dark:text-blue-200",children:[f.visitedCount,"/",f.totalStops]}),e.jsxs("p",{className:"text-xs text-blue-600",children:[f.progressPercent,"% visitados"]})]}),e.jsxs("div",{className:"p-3 rounded-xl bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-100 dark:border-emerald-800",children:[e.jsxs("p",{className:"text-xs text-emerald-600 dark:text-emerald-400 font-semibold flex items-center gap-1",children:[e.jsx($e,{size:12})," Cobrado Hoy"]}),e.jsx("p",{className:"text-lg font-bold text-emerald-800 dark:text-emerald-200",children:p(D)}),e.jsxs("p",{className:"text-xs text-emerald-600",children:[G," recibos"]})]}),e.jsxs("div",{className:"p-3 rounded-xl bg-amber-50 dark:bg-amber-900/20 border border-amber-100 dark:border-amber-800",children:[e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400 font-semibold",children:"Pendiente"}),e.jsx("p",{className:"text-lg font-bold text-amber-800 dark:text-amber-200",children:p(B-D)}),e.jsxs("p",{className:"text-xs text-amber-600",children:[v.length-f.paidCount," paradas"]})]}),e.jsxs("div",{className:"p-3 rounded-xl bg-violet-50 dark:bg-violet-900/20 border border-violet-100 dark:border-violet-800",children:[e.jsx("p",{className:"text-xs text-violet-600 dark:text-violet-400 font-semibold",children:"Efectividad"}),e.jsxs("p",{className:"text-lg font-bold text-violet-800 dark:text-violet-200",children:[f.collectionPercent,"%"]}),e.jsxs("p",{className:"text-xs text-violet-600",children:[f.paidCount," pagaron"]})]})]}),v.length>0&&e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-3 border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Progreso de la ruta"}),e.jsxs("span",{className:"font-semibold text-slate-800 dark:text-slate-200",children:[f.progressPercent,"%"]})]}),e.jsx("div",{className:"h-3 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 to-emerald-500 transition-all duration-500",style:{width:`${f.progressPercent}%`}})}),e.jsxs("div",{className:"flex justify-between text-[10px] mt-1 text-slate-500",children:[e.jsxs("span",{children:[f.visitedCount," visitados"]}),e.jsxs("span",{children:[f.paidCount," pagaron"]}),e.jsxs("span",{children:[f.totalStops-f.visitedCount," restantes"]})]})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs md:text-sm font-medium text-slate-600 dark:text-slate-400",children:"Cobrador:"}),e.jsxs("select",{className:"p-2 border rounded-lg bg-white dark:bg-slate-800 text-sm dark:text-slate-200 dark:border-slate-700",value:h,onChange:t=>ge(t.target.value),children:[e.jsx("option",{value:"",children:"Todos"}),L.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),ne.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{size:14,className:"text-slate-400"}),e.jsxs("select",{className:"p-2 border rounded-lg bg-white dark:bg-slate-800 text-sm dark:text-slate-200 dark:border-slate-700",value:R,onChange:t=>ye(t.target.value),children:[e.jsx("option",{value:"ALL",children:"Todas las zonas"}),ne.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Me,{size:14,className:"text-slate-400"}),e.jsxs("select",{className:"p-2 border rounded-lg bg-white dark:bg-slate-800 text-sm dark:text-slate-200 dark:border-slate-700",value:U,onChange:t=>we(t.target.value),children:[e.jsx("option",{value:"address",children:"Por Dirección"}),e.jsx("option",{value:"name",children:"Por Nombre"}),e.jsx("option",{value:"amount",children:"Por Monto"}),e.jsx("option",{value:"number",children:"Por Cuota #"})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Oe,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Buscar cliente o dirección...",value:z,onChange:t=>ke(t.target.value),className:"w-full pl-9 p-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-800 dark:text-slate-200 text-sm"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("button",{type:"button",onClick:fe,className:"flex-1 sm:flex-none inline-flex items-center justify-center gap-1.5 bg-emerald-600 text-white px-3 py-2 rounded-lg text-xs md:text-sm font-semibold shadow-md hover:bg-emerald-700",children:[e.jsx(W,{size:14})," ",he?"En curso":"Iniciar"]}),e.jsxs("button",{type:"button",onClick:Ce,className:"inline-flex items-center gap-2 bg-blue-600 text-white px-3 py-2 rounded-lg text-xs font-semibold shadow-md hover:bg-blue-700",children:[e.jsx(Ve,{size:14})," Agregar todos"]}),e.jsx("button",{type:"button",onClick:()=>{if(!h){b&&b("Selecciona un cobrador para cuadrar la ruta.","error");return}V(!0)},className:"inline-flex items-center gap-2 bg-slate-700 text-white px-3 py-2 rounded-lg text-xs font-semibold shadow-md hover:bg-slate-600",children:"Cerrar Cuadre"}),e.jsx("button",{type:"button",onClick:()=>{const t=!!h;if((()=>{if(!t||!Array.isArray(y))return!1;const r=new Date;r.setHours(0,0,0,0);const d=new Date(r);return d.setDate(d.getDate()+1),y.some(o=>{const m=g.find(x=>x.id===o.clientId);if(!m||m.collectorId!==h)return!1;const C=new Date(o.date);return C>=r&&C<d})})()&&!ee){te(!0),b&&b("Presiona de nuevo para confirmar limpieza de ruta.","info");return}pe(),te(!1),se({}),de({}),b&&b("Ruta limpiada.","success")},className:"inline-flex items-center gap-2 bg-slate-200 text-slate-700 px-3 py-2 rounded-lg text-xs font-semibold hover:bg-slate-300",children:ee?"Confirmar":"Limpiar"}),e.jsx("button",{type:"button",onClick:()=>window.print(),className:"inline-flex items-center gap-2 bg-slate-900 text-white px-3 py-2 rounded-lg text-xs font-semibold shadow-md hover:bg-slate-800",children:e.jsx(Se,{size:16})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-3",children:[v.map((t,a)=>{var C;const r=`${t.loanId}:${t.id}`,d=I.includes(r),o=A[t.id]||"PENDING",m=re[t.id];return e.jsx("div",{className:`glass p-4 rounded-xl transition-all ${o==="PAID"?"opacity-60 border-emerald-300":o==="REFUSED"||o==="NOT_HOME"?"opacity-75 border-amber-300":""}`,children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 w-full md:w-auto",children:[e.jsx("div",{className:"bg-indigo-100 dark:bg-indigo-600 text-indigo-700 dark:text-white w-8 h-8 rounded-full flex-shrink-0 flex items-center justify-center font-bold text-sm",children:a+1}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-100 dark:bg-slate-800 overflow-hidden border border-slate-200 dark:border-slate-700 flex-shrink-0",children:t.clientPhotoUrl?e.jsx("img",{src:t.clientPhotoUrl,className:"w-full h-full object-cover",alt:""}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-xs text-slate-400 font-bold",children:(C=t.clientName)==null?void 0:C.charAt(0)})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("h4",{className:"font-bold text-slate-800 dark:text-slate-100 text-sm truncate",children:t.clientName}),Ae(o)]}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 flex items-center gap-1 truncate",children:[e.jsx(W,{size:10})," ",t.clientAddress]}),e.jsxs("p",{className:"text-[10px] text-slate-400 mt-0.5",children:["Cuota #",t.number," • ",q(t.date)," • ",e.jsx("span",{className:"font-semibold",children:p(t.payment)})]}),m&&e.jsxs("p",{className:"text-[10px] text-blue-600 dark:text-blue-400 mt-1 flex items-center gap-1",children:[e.jsx(K,{size:10})," ",m]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 w-full md:w-auto",children:[e.jsxs("div",{className:"flex items-center gap-1 justify-end",children:[t.clientAddress&&e.jsx("a",{href:`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(t.clientAddress)}`,target:"_blank",rel:"noopener noreferrer",className:"p-1.5 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-lg hover:bg-blue-200",title:"Navegar con GPS",children:e.jsx(Re,{size:14})}),t.clientPhone&&e.jsx("a",{href:`tel:${t.clientPhone}`,className:"p-1.5 bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-400 rounded-lg hover:bg-slate-200",title:"Llamar",children:e.jsx(Fe,{size:14})}),t.clientPhone&&e.jsx("a",{href:`https://wa.me/${t.clientPhone.replace(/\D/g,"")}?text=${encodeURIComponent(`Hola ${t.clientName}, le recordamos que tiene una cuota pendiente de ${p(t.payment)}. ¿Estará disponible hoy para realizar el pago?`)}`,target:"_blank",rel:"noopener noreferrer",className:"p-1.5 bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 rounded-lg hover:bg-green-200",title:"WhatsApp",children:e.jsx(Be,{size:14})}),e.jsx("button",{onClick:()=>H(t),className:`p-1.5 rounded-lg ${m?"bg-amber-100 dark:bg-amber-900/30 text-amber-600":"bg-slate-100 dark:bg-slate-700 text-slate-400"}`,title:"Notas",children:e.jsx(K,{size:14})}),e.jsx("button",{type:"button",onClick:()=>Q(t.loanId,t.id),className:`px-2 py-1 rounded-lg text-[10px] font-semibold border ${d?"bg-emerald-50 border-emerald-500 text-emerald-700":"bg-slate-100 border-slate-300 text-slate-500 hover:bg-slate-200"}`,children:d?"✓ En ruta":"+ Agregar"})]}),e.jsx("div",{className:"flex items-center gap-1",children:ue.filter(x=>x.value!=="PENDING").map(x=>e.jsx("button",{onClick:()=>ie(t.id,x.value),className:`p-1 rounded text-[10px] ${o===x.value?`bg-${x.color}-500 text-white`:`bg-${x.color}-100 text-${x.color}-600 hover:bg-${x.color}-200`}`,title:x.label,children:e.jsx(x.icon,{size:12})},x.value))}),o!=="PAID"&&e.jsxs("button",{onClick:()=>{Ne(""),S({loanId:t.loanId,installmentId:t.id,amount:t.payment,number:t.number,date:t.date,clientName:t.clientName})},className:"w-full bg-emerald-600 text-white px-3 py-2 rounded-lg text-sm font-bold shadow-md hover:bg-emerald-500 flex items-center justify-center gap-2",children:[e.jsx($,{size:14})," Cobrar"]})]})]})},t.id)}),v.length===0&&e.jsxs("div",{className:"text-center py-12 bg-white dark:bg-slate-800 rounded-xl border border-dashed border-slate-300 dark:border-slate-700",children:[e.jsx($,{size:48,className:"text-green-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-bold text-slate-700 dark:text-slate-300",children:"¡Ruta Completada!"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"No hay cobros pendientes."})]})]}),e.jsxs("div",{className:"lg:col-span-1 space-y-4",children:[e.jsxs(Z,{className:"bg-slate-50 dark:bg-slate-800 border-slate-200 dark:border-slate-700",children:[e.jsx("h3",{className:"font-bold text-slate-800 dark:text-slate-200 mb-4",children:"Resumen de Ruta"}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"Total a Recaudar"}),e.jsx("span",{className:"font-bold text-slate-800 dark:text-slate-200",children:p(B)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"Cobrado Hoy"}),e.jsx("span",{className:"font-bold text-emerald-600",children:p(D)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"Clientes en Ruta"}),e.jsx("span",{className:"font-bold text-slate-800 dark:text-slate-200",children:T.length})]})]})]}),e.jsxs(Z,{className:"bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700",children:[e.jsx("h3",{className:"font-bold text-slate-800 dark:text-slate-200 mb-2",children:"Ruta Armada"}),T.length===0?e.jsx("p",{className:"text-xs text-slate-400",children:"Selecciona clientes para armar la ruta."}):e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsx("ul",{className:"divide-y divide-slate-100 dark:divide-slate-700 max-h-40 overflow-y-auto",children:T.map(t=>e.jsxs("li",{className:"py-1 flex justify-between",children:[e.jsx("span",{className:"truncate mr-2",children:t.clientName}),e.jsx("span",{className:"font-semibold",children:p(t.payment)})]},t.id))}),e.jsxs("div",{className:"pt-2 border-t border-slate-100 dark:border-slate-700 flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:"Total"}),e.jsx("span",{className:"font-bold",children:p(T.reduce((t,a)=>t+a.payment,0))})]})]})]}),j&&e.jsxs(Z,{className:"bg-emerald-50 dark:bg-emerald-900/20 border-emerald-200 dark:border-emerald-800",children:[e.jsx("h3",{className:"font-bold text-emerald-800 dark:text-emerald-300 mb-2 text-sm",children:"Último cuadre"}),e.jsxs("p",{className:"text-xs text-emerald-700 dark:text-emerald-400",children:[q(j.date)," • ",j.receiptsCount," recibos"]}),e.jsx("p",{className:"text-sm font-bold text-emerald-700 dark:text-emerald-300",children:p(j.totalAmount)}),e.jsx("button",{type:"button",onClick:()=>ae(!0),className:"mt-2 text-[11px] font-semibold text-emerald-800 dark:text-emerald-300 underline",children:"Ver tickets"})]})]})]}),E&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-2xl p-6 w-full max-w-sm animate-fade-in",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-800 dark:text-slate-100 mb-2 flex items-center gap-2",children:[e.jsx(K,{size:20,className:"text-amber-500"}),"Notas de Visita"]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-3",children:E.clientName}),e.jsx("textarea",{defaultValue:re[E.id]||"",placeholder:"Escribe observaciones...",className:"w-full p-3 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900/50 text-slate-800 dark:text-slate-200 min-h-[100px]",id:"visitNoteInput"}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx("button",{onClick:()=>H(null),className:"flex-1 py-2 rounded-lg bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 font-semibold",children:"Cancelar"}),e.jsx("button",{onClick:()=>{const t=document.getElementById("visitNoteInput");Pe(E.id,(t==null?void 0:t.value)||"")},className:"flex-1 py-2 rounded-lg bg-amber-600 text-white font-semibold hover:bg-amber-500",children:"Guardar"})]})]})}),ve&&j&&e.jsx("div",{className:"fixed inset-0 bg-slate-900/70 flex items-center justify-center z-50",children:e.jsxs("div",{className:"w-full max-w-lg bg-white dark:bg-slate-800 rounded-2xl shadow-2xl p-6 max-h-[80vh] flex flex-col",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-slate-100 mb-1",children:"Tickets del cuadre"}),e.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-400 mb-3",children:[(ce=L.find(t=>t.id===j.collectorId))==null?void 0:ce.name," • ",q(j.date)]}),e.jsx("div",{className:"flex-1 overflow-y-auto border border-slate-100 dark:border-slate-700 rounded-xl",children:oe.length===0?e.jsx("div",{className:"p-4 text-sm text-slate-500 text-center",children:"No se encontraron tickets."}):e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700 text-slate-600 dark:text-slate-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-left",children:"Cliente"}),e.jsx("th",{className:"p-2 text-right",children:"Cuota"}),e.jsx("th",{className:"p-2 text-right",children:"Mora"}),e.jsx("th",{className:"p-2 text-right",children:"Total"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:oe.map(t=>{const a=parseFloat(t.amount||0),r=parseFloat(t.penaltyAmount||0);return e.jsxs("tr",{children:[e.jsx("td",{className:"p-2 truncate max-w-[140px]",children:t.clientName}),e.jsx("td",{className:"p-2 text-right",children:p(a)}),e.jsx("td",{className:"p-2 text-right text-amber-600",children:p(r)}),e.jsx("td",{className:"p-2 text-right font-semibold text-emerald-700",children:p(a+r)})]},t.id)})})]})}),e.jsx("button",{type:"button",onClick:()=>ae(!1),className:"mt-4 w-full text-xs text-slate-500 hover:text-slate-700",children:"Cerrar"})]})}),je&&e.jsx("div",{className:"fixed inset-0 bg-slate-900/80 flex items-center justify-center z-50 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"w-full max-w-md bg-white dark:bg-slate-800 rounded-2xl shadow-2xl p-6 text-center",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-slate-100 mb-2",children:"Confirmar Cuadre"}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-4",children:["Cobrador: ",e.jsx("span",{className:"font-semibold text-slate-700 dark:text-slate-200",children:(xe=L.find(t=>t.id===h))==null?void 0:xe.name})]}),e.jsxs("div",{className:"bg-emerald-50 dark:bg-emerald-900/30 rounded-xl p-6 mb-4",children:[e.jsx("p",{className:"text-sm text-emerald-700 dark:text-emerald-300 mb-1 uppercase tracking-wider font-semibold",children:"Total a Recibir"}),e.jsx("p",{className:"text-4xl font-black text-emerald-600 dark:text-emerald-400",children:p(D||0)})]}),e.jsx("div",{className:"flex justify-center gap-6 mb-6 text-sm",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100",children:G||0}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"Recibos"})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>V(!1),className:"flex-1 px-4 py-3 border border-slate-300 dark:border-slate-600 text-slate-600 dark:text-slate-300 rounded-xl font-semibold",children:"Cancelar"}),e.jsx("button",{type:"button",onClick:()=>{J&&J({collectorId:h,date:new Date().toISOString(),totalAmount:D||0,receiptsCount:G||0}),X&&X(),V(!1),b&&b("Cuadre registrado correctamente.","success")},className:"flex-1 px-4 py-3 bg-emerald-600 text-white rounded-xl font-bold hover:bg-emerald-500 shadow-lg",children:"✓ Confirmar"})]})]})}),Y&&e.jsx(Te,{paymentToConfirm:Y,onConfirm:async(t,a,r)=>{const d=await be(t,a,{...r,suppressAutoPrint:!0});d&&(le(d),ie(a,"PAID")),S(null)},onCancel:()=>S(null)}),F&&e.jsx(Ee,{receipt:F,companyName:(n==null?void 0:n.companyName)||"RenKredit",companyLogo:n==null?void 0:n.companyLogo,onClose:()=>le(null),onPrint:async()=>{const{printModernTicket:t}=await ze(()=>import("./printUtils-04a0a819.js"),[],import.meta.url);t(F,{companyName:(n==null?void 0:n.companyName)||"RenKredit",companyLogo:(n==null?void 0:n.companyLogo)||"",companyAddress:(n==null?void 0:n.companyAddress)||"",companyPhone:(n==null?void 0:n.companyPhone)||"",companyWhatsApp:(n==null?void 0:n.companyWhatsApp)||""})}})]})}export{bt as RoutesView};
