import{c as C,j as e,X as P,a as A,d as R,f as r}from"./index-d07a4565.js";import{r as g}from"./vendor-8a332d8f.js";import S from"./html2canvas.esm-e0a7d97b.js";import{printModernTicket as B}from"./printUtils-04a0a819.js";import{S as $}from"./PaymentConfirmationModal-888311d5.js";import{P as D}from"./printer-82ab4f0e.js";const G=C("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]),z=({receipt:a,onClose:j,onPrint:E,companyName:d,baseAmount:x,penaltyAmount:c,companyLogo:o})=>{var h;const i=g.useRef(null),[b,t]=g.useState(!1),N=typeof(a==null?void 0:a.amount)=="number"?a.amount:parseFloat((a==null?void 0:a.amount)||0)||0,k=typeof(a==null?void 0:a.penaltyAmount)=="number"?a.penaltyAmount:parseFloat((a==null?void 0:a.penaltyAmount)||0)||0,v=x!==void 0?x:N,m=c!==void 0?c:k,p=v+m,y=async()=>{if(i.current){t(!0);try{(await S(i.current,{scale:2,backgroundColor:"#ffffff",logging:!1})).toBlob(async l=>{if(!l){t(!1);return}if(navigator.share&&navigator.canShare){const u={files:[new File([l],`comprobante - ${a.id}.png`,{type:"image/png"})],title:"Comprobante de Pago",text:`Comprobante de pago - ${d} `};if(navigator.canShare(u))try{await navigator.share(u),t(!1);return}catch(w){console.log("Error sharing or user cancelled",w)}}const f=URL.createObjectURL(l),n=document.createElement("a");n.href=f,n.download=`comprobante - ${a.id}.png`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(f),t(!1)},"image/png")}catch(s){console.error("Error generating receipt image",s),t(!1)}}};return e.jsx("div",{className:"fixed inset-0 z-[60] bg-slate-900/40 backdrop-blur-sm flex items-center justify-center p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-3xl shadow-2xl w-full max-w-sm overflow-hidden flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"bg-slate-900 dark:bg-slate-950 text-white p-4 flex items-center justify-between",children:[e.jsx("span",{className:"font-bold text-lg",children:"Comprobante"}),e.jsx("button",{onClick:j,className:"p-1 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(P,{size:24})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto bg-slate-50 dark:bg-slate-900 thermal-receipt",ref:i,children:e.jsxs("div",{className:"p-3 bg-white dark:bg-slate-900",children:[e.jsxs("div",{className:"flex flex-col items-center mb-3",children:[o?e.jsx("div",{className:"mb-2",children:e.jsx("img",{src:o,alt:d,className:"h-12 w-auto object-contain"})}):e.jsx("div",{className:"w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center mb-2 shadow-lg shadow-blue-500/30",children:e.jsx(A,{size:28,className:"text-white",strokeWidth:3})}),e.jsx("h2",{className:"text-base font-bold text-slate-800 dark:text-slate-100 text-center",children:"¡Transacción completada!"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:R(a.date)}),e.jsx("div",{className:"mt-1 bg-slate-200 dark:bg-slate-800 px-2 py-0.5 rounded-full text-[10px] font-mono text-slate-600 dark:text-slate-400",children:((h=a==null?void 0:a.id)==null?void 0:h.slice(0,12))||"N/A"})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800/50 rounded-xl p-3 shadow-sm border border-slate-100 dark:border-slate-700 mb-2 text-center",children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Monto Total"}),e.jsx("p",{className:"text-2xl font-black text-slate-800 dark:text-slate-100",children:r(p)}),e.jsx("p",{className:"text-[10px] font-bold text-blue-600 dark:text-blue-400 uppercase tracking-wide",children:"PAGO DE PRÉSTAMO"})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800/50 rounded-xl p-2 shadow-sm border border-slate-100 dark:border-slate-700 space-y-1",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-1",children:e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Cliente"}),e.jsx("p",{className:"font-bold text-slate-800 dark:text-slate-200 text-sm",children:a.clientName}),a.clientPhone&&e.jsx("p",{className:"text-xs text-slate-400",children:a.clientPhone})]})]}),e.jsx("div",{className:"border-t border-slate-100 dark:border-slate-700 my-2"}),a.paymentBreakdown&&a.paymentBreakdown.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500"}),a.isPartialPayment?"Abonos Realizados":"Cuotas Pagadas"]}),a.paymentBreakdown.map((s,l)=>e.jsxs("div",{className:"flex justify-between text-sm bg-emerald-50 dark:bg-emerald-900/20 p-2 rounded-lg",children:[e.jsx("span",{className:"text-slate-700 dark:text-slate-300",children:s.isPartialPayment?`Abono a Cuota #${s.number}`:`Cuota #${s.number}`}),e.jsx("span",{className:"font-semibold text-emerald-600",children:r(s.amount)})]},l)),a.penaltyAmount>0&&e.jsxs("div",{className:"flex justify-between text-sm bg-amber-50 dark:bg-amber-900/20 p-2 rounded-lg",children:[e.jsx("span",{className:"text-amber-700 dark:text-amber-300",children:"Mora"}),e.jsx("span",{className:"font-semibold text-amber-600",children:r(a.penaltyAmount)})]})]}):e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-1",children:e.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Detalle"}),e.jsx("p",{className:"font-medium text-slate-800 dark:text-slate-200 text-sm",children:a.isPartialPayment?`Abono a Cuota #${a.installmentNumber}`:`Cuota #${a.installmentNumber}`}),m>0&&e.jsxs("p",{className:"text-xs text-amber-600 font-semibold",children:["Incluye mora: ",r(m)]})]})]}),a.remainingBalance!==void 0&&a.remainingBalance>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-t border-slate-100 dark:border-slate-700 my-2"}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-500",children:"Saldo Pendiente:"}),e.jsx("span",{className:"font-bold text-slate-800 dark:text-slate-200",children:r(a.remainingBalance)})]})]})]})]})}),e.jsxs("div",{className:"p-4 bg-white dark:bg-slate-950 border-t border-slate-100 dark:border-slate-800 flex gap-3",children:[e.jsx("button",{onClick:y,disabled:b,className:"flex-1 bg-emerald-600 hover:bg-emerald-700 disabled:opacity-70 text-white py-3 rounded-xl font-bold text-sm flex items-center justify-center gap-2 transition-colors shadow-lg shadow-emerald-900/20",children:b?e.jsx(e.Fragment,{children:"...Generando"}):e.jsxs(e.Fragment,{children:[e.jsx($,{size:18})," Compartir Recibo"]})}),e.jsx("button",{onClick:()=>{B(a,{companyName:d,companyLogo:o})},className:"bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-200 p-3 rounded-xl hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors",title:"Imprimir Ticket 58mm",children:e.jsx(D,{size:20})})]})]})})},W=z;export{W as D,G as N};
