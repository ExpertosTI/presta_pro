import{c as Ae,j as e,d as re,f as i,X as Ue,a as Ze,_ as ye,W as ne,C as Q,F as we,b as $,l as U}from"./index-d07a4565.js";import{r as o}from"./vendor-8a332d8f.js";import{B as de}from"./Badge-2d4e4979.js";import{c as Je}from"./amortization-62a7b0b1.js";import{S as et,P as tt}from"./PaymentConfirmationModal-888311d5.js";import{printThermalTicket as at,printHtmlContent as st}from"./printUtils-04a0a819.js";import{P as ce}from"./printer-82ab4f0e.js";import{B as lt}from"./banknote-5ac92043.js";import{P as rt}from"./plus-968e5801.js";import{T as nt}from"./trending-up-aed1c674.js";import{C as dt}from"./clock-0f83d6c6.js";import{C as ot}from"./calendar-da7962d8.js";import{X as oe}from"./x-circle-177d4c0c.js";import{T as Ce}from"./trash-2-8bdf2c52.js";import{R as Ie}from"./refresh-cw-25914484.js";import{S as Pe}from"./sticky-note-bd8db19a.js";const ie=Ae("Archive",[["rect",{width:"20",height:"5",x:"2",y:"4",rx:"2",key:"uhwcea"}],["path",{d:"M4 9v9a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9",key:"shkvi4"}],["path",{d:"M10 13h4",key:"ytezjc"}]]),it=Ae("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);function ct({receipt:s,companyName:c="Renace.tech",systemSettings:u={},onClose:h,isCopy:N=!1}){if(!s)return null;const g=u.companyName||c,f=s.penalty&&s.penalty>0,xe=s.paidInstallments&&s.paidInstallments.length>0,j=async()=>{var w,z;const v=`
‚úÖ RECIBO DE PAGO${N?" (COPIA)":""}
${g}

üìã Recibo #: ${s.id.substr(0,8).toUpperCase()}
üìÖ Fecha: ${re(s.date)}
üë§ Cliente: ${s.clientName}

üí∞ Monto: ${i(s.amount)}
${f?`‚ö†Ô∏è Mora: ${i(s.penalty)}`:""}
üíµ TOTAL: ${i(s.total||s.amount+(s.penalty||0))}

${s.remainingBalance!==void 0?`üìä Saldo: ${i(s.remainingBalance)}`:""}

¬°Gracias por su pago!
    `.trim();if(navigator.share)try{await navigator.share({title:"Recibo de Pago",text:v})}catch{(w=navigator.clipboard)==null||w.writeText(v)}else(z=navigator.clipboard)==null||z.writeText(v),alert("Recibo copiado al portapapeles")},B=()=>{at(s,{companyName:g,isCopy:N}),setTimeout(()=>h==null?void 0:h(),500)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden print:block fixed inset-0 bg-white z-[100] p-1 font-mono text-black",style:{fontSize:"9px",lineHeight:"1.2"},children:e.jsxs("div",{style:{maxWidth:"48mm",margin:"0 auto"},children:[N&&e.jsx("div",{className:"text-center font-bold border-2 border-black mb-1 py-0.5",style:{fontSize:"12px"},children:"*** COPIA ***"}),e.jsxs("div",{className:"text-center border-b border-black pb-1 mb-1",children:[e.jsx("div",{style:{fontSize:"11px",fontWeight:"bold"},children:g}),e.jsxs("div",{style:{fontSize:"8px"},children:["COMPROBANTE DE PAGO",N?" (REIMPRESO)":""]}),e.jsxs("div",{style:{fontSize:"7px"},children:["Ref: ",s.id.substr(0,12).toUpperCase()]}),e.jsx("div",{style:{fontSize:"7px"},children:re(s.date)})]}),e.jsxs("div",{style:{borderBottom:"1px dashed #000",paddingBottom:"2px",marginBottom:"2px"},children:[e.jsx("div",{style:{fontWeight:"bold"},children:"CLIENTE"}),e.jsx("div",{children:s.clientName}),e.jsx("div",{style:{fontSize:"8px"},children:s.clientPhone||""})]}),e.jsxs("div",{style:{borderBottom:"1px dashed #000",paddingBottom:"2px",marginBottom:"2px"},children:[e.jsx("div",{style:{fontWeight:"bold"},children:"PR√âSTAMO"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Capital"}),e.jsx("span",{children:i(s.loanAmount||0)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Cuota(s) Pagada(s)"}),e.jsxs("span",{children:["#",s.installmentNumber||1]})]}),e.jsxs("div",{className:"flex justify-between",style:{marginTop:"2px",borderTop:"1px dotted #ccc",paddingTop:"2px"},children:[e.jsx("span",{children:"Saldo Restante"}),e.jsx("span",{style:{fontWeight:"bold"},children:i(s.remainingBalance||0)})]})]}),e.jsxs("div",{style:{borderBottom:"1px dashed #000",paddingBottom:"2px",marginBottom:"2px"},children:[e.jsx("div",{style:{fontWeight:"bold"},children:"DETALLE"}),xe?e.jsx(e.Fragment,{children:s.paidInstallments.map((v,w)=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["Cuota #",v.number]}),e.jsx("span",{children:i(v.amount)})]},w))}):e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:s.isPartialPayment?`Abono #${s.installmentNumber}`:`Cuota #${s.installmentNumber}`}),e.jsx("span",{children:i(s.amount)})]}),f&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Mora"}),e.jsx("span",{children:i(s.penalty)})]})]}),e.jsxs("div",{className:"text-center",style:{padding:"4px 0",borderBottom:"2px solid #000",marginBottom:"4px"},children:[e.jsx("div",{style:{fontSize:"8px"},children:"TOTAL PAGADO"}),e.jsx("div",{style:{fontSize:"14px",fontWeight:"bold"},children:i(s.total||s.amount+(s.penalty||0))}),e.jsx("div",{style:{fontSize:"7px"},children:s.isPartialPayment?"ABONO A CUOTA":"PAGO DE PR√âSTAMO"})]}),e.jsxs("div",{className:"text-center",style:{fontSize:"7px"},children:[e.jsx("div",{style:{fontWeight:"bold"},children:"¬°Gracias por su pago!"}),e.jsx("div",{style:{color:"#666"},children:"Conserve este comprobante"})]})]})}),e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4 print:hidden",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 w-full max-w-sm rounded-2xl shadow-2xl overflow-hidden animate-fade-in",children:[e.jsxs("div",{className:"bg-gradient-to-r from-emerald-500 to-teal-600 p-4 text-white text-center relative",children:[e.jsx("button",{onClick:h,className:"absolute top-3 right-3 p-1.5 hover:bg-white/20 rounded-full transition-colors",children:e.jsx(Ue,{size:18})}),e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-2",children:e.jsx(Ze,{size:24})}),e.jsx("h3",{className:"text-lg font-bold",children:"¬°Pago Registrado!"}),e.jsx("p",{className:"text-sm text-white/80",children:g})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Recibo #"}),e.jsx("span",{className:"font-mono text-sm font-semibold text-slate-800 dark:text-slate-200",children:s.id.substr(0,8).toUpperCase()})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Cliente"}),e.jsx("span",{className:"font-semibold text-slate-800 dark:text-slate-200 text-sm",children:s.clientName})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Fecha"}),e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:re(s.date)})]}),e.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-700 pt-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Monto"}),e.jsx("span",{className:"font-semibold text-slate-800 dark:text-slate-200",children:i(s.amount)})]}),f&&e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsx("span",{className:"text-rose-600",children:"Mora"}),e.jsx("span",{className:"font-semibold text-rose-600",children:i(s.penalty)})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2 pt-2 border-t border-slate-200 dark:border-slate-700",children:[e.jsx("span",{className:"font-bold text-slate-900 dark:text-slate-100",children:"TOTAL"}),e.jsx("span",{className:"text-xl font-bold text-emerald-600",children:i(s.total||s.amount+(s.penalty||0))})]})]}),s.remainingBalance!==void 0&&e.jsxs("div",{className:"bg-slate-100 dark:bg-slate-700/50 rounded-lg p-2 text-center",children:[e.jsx("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Saldo del pr√©stamo: "}),e.jsx("span",{className:"font-semibold text-slate-800 dark:text-slate-200",children:i(s.remainingBalance)})]})]}),e.jsxs("div",{className:"p-4 pt-0 grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:j,className:"flex items-center justify-center gap-2 py-3 px-4 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-xl font-semibold hover:from-blue-600 hover:to-indigo-700 transition-all active:scale-95",children:[e.jsx(et,{size:18}),e.jsx("span",{children:"Compartir"})]}),e.jsxs("button",{onClick:B,className:"flex items-center justify-center gap-2 py-3 px-4 bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-200 rounded-xl font-semibold hover:bg-slate-300 dark:hover:bg-slate-600 transition-all active:scale-95",children:[e.jsx(ce,{size:18}),e.jsx("span",{children:"Imprimir"})]})]}),e.jsx("div",{className:"p-4 pt-0",children:e.jsx("button",{onClick:h,className:"w-full py-2.5 text-slate-500 dark:text-slate-400 text-sm hover:text-slate-700 dark:hover:text-slate-200 transition-colors",children:"Cerrar"})})]})})]})}function Tt({loans:s,clients:c,collectors:u=[],registerPayment:h,selectedLoanId:N,onSelectLoan:g,onUpdateLoan:f,addClientDocument:xe,onCreateLoan:j,onNewClient:B,onNavigateToDocuments:v}){const[w,z]=o.useState(!1),[Te,De]=o.useState(null),[xt,Ee]=o.useState(!1),[me,Z]=o.useState(null),[mt,ze]=o.useState(""),[Se,J]=o.useState(!1),[b,P]=o.useState({amount:"",rate:"",term:"",frequency:"Mensual",startDate:""}),[be,_]=o.useState(""),[Fe,q]=o.useState(!1),[d,k]=o.useState({clientId:"",amount:"",rate:"20",term:"12",frequency:"Mensual",startDate:new Date().toISOString().split("T")[0],closingCosts:"",amortizationType:"FLAT"}),[pe,ee]=o.useState(""),[ue,he]=o.useState(null),[G,Me]=o.useState(""),[V,Oe]=o.useState("ALL"),[S,Re]=o.useState(!1),[A,Le]=o.useState("date"),[X,$e]=o.useState("desc"),[F,Be]=o.useState("ALL"),[H,_e]=o.useState("ALL"),[M,ge]=o.useState(""),[O,fe]=o.useState(""),[R,W]=o.useState({show:!1,loanId:null,notes:""}),[qe,te]=o.useState(!1),[Ge,ae]=o.useState(!1),[Ve,Y]=o.useState(!1),[Xe,K]=o.useState(!1),[He,je]=o.useState(!1),[T,D]=o.useState(!1),[ve,se]=o.useState(""),[ke,le]=o.useState({show:!1,message:""}),Ne=o.useMemo(()=>{let t=s.filter(l=>{if(!S&&l.archived||V!=="ALL"&&l.status!==V)return!1;if(F!=="ALL"){const r=l.amortizationType==="OPEN"||l.type==="OPEN";if(F==="OPEN"&&!r||F==="FIXED"&&r)return!1}if(H!=="ALL"){const r=c.find(n=>n.id===l.clientId);if((r==null?void 0:r.collectorId)!==H)return!1}if(M&&new Date(l.startDate||l.createdAt)<new Date(M)||O&&new Date(l.startDate||l.createdAt)>new Date(O))return!1;if(G.trim()){const r=c.find(x=>x.id===l.clientId);if(!((r==null?void 0:r.name)||"").toLowerCase().includes(G.toLowerCase()))return!1}return!0});return t.sort((l,r)=>{let n,x;const C=c.find(m=>m.id===l.clientId),I=c.find(m=>m.id===r.clientId);return A==="date"?(n=new Date(l.startDate||l.createdAt),x=new Date(r.startDate||r.createdAt)):A==="amount"?(n=parseFloat(l.amount)||0,x=parseFloat(r.amount)||0):A==="client"?(n=((C==null?void 0:C.name)||"").toLowerCase(),x=((I==null?void 0:I.name)||"").toLowerCase()):A==="status"&&(n=l.status||"",x=r.status||""),n<x?X==="asc"?-1:1:n>x?X==="asc"?1:-1:0}),t},[s,c,G,V,S,F,H,M,O,A,X]),a=o.useMemo(()=>s.find(t=>t.id===N),[s,N]),p=o.useMemo(()=>a?c.find(t=>t.id===a.clientId):null,[a,c]),y=o.useMemo(()=>!a||!a.schedule?null:a.schedule.find(t=>t.status!=="PAID"),[a]),E=o.useMemo(()=>{const t=s.filter(m=>!m.archived&&m.status==="ACTIVE"),l=t.reduce((m,L)=>m+parseFloat(L.amount||0),0),r=t.reduce((m,L)=>m+(L.totalInterest||0),0),n=t.reduce((m,L)=>m+(L.totalPaid||0),0),x=l+r-n,C=t.filter(m=>m.amortizationType!=="OPEN"&&m.type!=="OPEN").length,I=t.filter(m=>m.amortizationType==="OPEN"||m.type==="OPEN").length;return{totalPortfolio:l,totalExpectedInterest:r,totalCollected:n,totalPending:x,activeCount:t.length,fixedCount:C,openCount:I}},[s]),We=()=>{!a||!f||Array.isArray(a.schedule)&&a.schedule.some(l=>l.status==="PAID")||(P({amount:String(a.amount||""),rate:String(a.rate||""),term:String(a.term||""),frequency:a.frequency||"Mensual",startDate:a.startDate||new Date().toISOString().split("T")[0],amortizationType:a.amortizationType||"FLAT"}),_(""),J(!0))},Ye=t=>{if(t.preventDefault(),!a||!f)return;const l=parseFloat(b.amount||"0"),r=parseFloat(b.rate||"0"),n=parseInt(b.term||"0",10);if(!l||!r||!n){_("Completa monto, tasa y plazo con valores v√°lidos.");return}try{const x=Je(l,r,n,b.frequency,b.startDate||a.startDate,b.amortizationType||"FLAT"),C={...a,amount:l,rate:r,term:n,frequency:b.frequency,amortizationType:b.amortizationType,startDate:b.startDate||a.startDate,schedule:x,totalInterest:x.reduce((I,m)=>I+m.interest,0),totalPaid:0,status:"ACTIVE"};f(C),J(!1)}catch(x){console.error(x),_("No se pudo recalcular la hoja de amortizaci√≥n. Revisa los datos.")}},Ke=async()=>{if(!(!a||!p)){z(!0);try{const t={}.VITE_GEMINI_API_KEY,{generateLoanContract:l}=await ye(()=>import("./index-d07a4565.js").then(n=>n.v),["./index-d07a4565.js","./vendor-8a332d8f.js","./index-fabd045c.css"],import.meta.url),r=await l(a,p,"Presta Pro",t);De(r),Ee(!0)}catch(t){console.error("Error generating loan contract with AI",t);const l=(t==null?void 0:t.message)||"";l==="API Key missing"||l==="INVALID_API_KEY"?alert("Falta configurar correctamente la API de IA (VITE_GEMINI_API_KEY) en este servidor."):l==="RATE_LIMIT"||(t==null?void 0:t.status)===429?alert("La IA de contratos alcanz√≥ el l√≠mite de uso. Intenta de nuevo en unos minutos."):alert("No se pudo generar el contrato en este momento. Intenta nuevamente m√°s tarde.")}finally{z(!1)}}},Qe=()=>{if(!a||!p)return;const t=a.schedule||[],l=t.reduce((n,x)=>n+(x.payment||0),0),r=`
      <div style="font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px;">
        <div style="text-align: center; margin-bottom: 20px; border-bottom: 2px solid #2563eb; padding-bottom: 15px;">
          <h1 style="margin: 0; color: #1e40af; font-size: 24px;">CALENDARIO DE PAGOS</h1>
          <p style="margin: 5px 0 0; color: #64748b; font-size: 12px;">Presta Pro by Renace.tech</p>
        </div>
        
        <div style="display: flex; justify-content: space-between; margin-bottom: 20px; background: #f8fafc; padding: 15px; border-radius: 8px;">
          <div>
            <p style="margin: 0 0 5px; font-size: 14px;"><strong>Cliente:</strong> ${p.name}</p>
            <p style="margin: 0 0 5px; font-size: 14px;"><strong>C√©dula/ID:</strong> ${p.idNumber||"N/A"}</p>
            <p style="margin: 0; font-size: 14px;"><strong>Tel√©fono:</strong> ${p.phone||"N/A"}</p>
          </div>
          <div style="text-align: right;">
            <p style="margin: 0 0 5px; font-size: 14px;"><strong>Monto financiado:</strong> ${i(a.amount)}</p>
            <p style="margin: 0 0 5px; font-size: 14px;"><strong>Plazo:</strong> ${a.term} cuotas</p>
            <p style="margin: 0 0 5px; font-size: 14px;"><strong>Frecuencia:</strong> ${a.frequency}</p>
            <p style="margin: 0; font-size: 14px;"><strong>Inicio:</strong> ${$(a.startDate)}</p>
          </div>
        </div>
        
        <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
          <thead>
            <tr style="background: #1e40af; color: white;">
              <th style="padding: 10px; text-align: center; border: 1px solid #1e3a8a;">No.</th>
              <th style="padding: 10px; text-align: left; border: 1px solid #1e3a8a;">Fecha de Pago</th>
              <th style="padding: 10px; text-align: right; border: 1px solid #1e3a8a;">Monto a Pagar</th>
              <th style="padding: 10px; text-align: right; border: 1px solid #1e3a8a;">Saldo Restante</th>
              <th style="padding: 10px; text-align: center; border: 1px solid #1e3a8a;">Estado</th>
              <th style="padding: 10px; text-align: center; border: 1px solid #1e3a8a;">Firma</th>
            </tr>
          </thead>
          <tbody>
            ${t.map((n,x)=>`
              <tr style="background: ${x%2===0?"#ffffff":"#f8fafc"};">
                <td style="padding: 8px; text-align: center; border: 1px solid #e2e8f0;">${n.number}</td>
                <td style="padding: 8px; border: 1px solid #e2e8f0;">${$(n.date)}</td>
                <td style="padding: 8px; text-align: right; border: 1px solid #e2e8f0; font-weight: bold;">${i(n.payment||0)}</td>
                <td style="padding: 8px; text-align: right; border: 1px solid #e2e8f0;">${i(n.balance||0)}</td>
                <td style="padding: 8px; text-align: center; border: 1px solid #e2e8f0;">
                  <span style="padding: 2px 8px; border-radius: 9999px; font-size: 10px; font-weight: bold; background: ${n.status==="PAID"?"#dcfce7":"#fef3c7"}; color: ${n.status==="PAID"?"#166534":"#92400e"};">
                    ${n.status==="PAID"?"PAGADO":"PENDIENTE"}
                  </span>
                </td>
                <td style="padding: 8px; border: 1px solid #e2e8f0; min-width: 60px;"></td>
              </tr>
            `).join("")}
          </tbody>
          <tfoot>
            <tr style="background: #1e40af; color: white; font-weight: bold;">
              <td colspan="2" style="padding: 10px; border: 1px solid #1e3a8a;">TOTAL A PAGAR</td>
              <td style="padding: 10px; text-align: right; border: 1px solid #1e3a8a;">${i(l)}</td>
              <td colspan="3" style="padding: 10px; border: 1px solid #1e3a8a;"></td>
            </tr>
          </tfoot>
        </table>
        
        <div style="margin-top: 30px; display: flex; justify-content: space-between;">
          <div style="width: 45%; border-top: 1px solid #000; padding-top: 5px; text-align: center;">
            <p style="margin: 0; font-size: 12px;">Firma del Cliente</p>
          </div>
          <div style="width: 45%; border-top: 1px solid #000; padding-top: 5px; text-align: center;">
            <p style="margin: 0; font-size: 12px;">Firma Empresa</p>
          </div>
        </div>
        
        <p style="margin-top: 20px; text-align: center; font-size: 10px; color: #94a3b8;">
          Generado el ${new Date().toLocaleString("es-DO")} ‚Ä¢ Presta Pro
        </p>
      </div>
    `;st(`Calendario de pagos - ${p.name}`,r)};return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[me&&e.jsx(tt,{paymentToConfirm:me,onConfirm:async(t,l,r)=>{const n=await h(t,l,r);if(n){const{printThermalTicket:x}=await ye(()=>import("./printUtils-04a0a819.js"),[],import.meta.url);x(n,{companyName:"Presta Pro"})}Z(null)},onCancel:()=>Z(null)}),Se&&a&&e.jsx("div",{className:"fixed inset-0 bg-slate-900/70 flex items-center justify-center z-50 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"w-full max-w-md bg-white dark:bg-slate-800 rounded-2xl shadow-2xl p-6 border border-slate-200 dark:border-slate-700",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-slate-100 mb-1",children:"Editar pr√©stamo"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mb-3",children:"Solo puedes editar pr√©stamos que a√∫n no tengan pagos registrados."}),be&&e.jsx("p",{className:"mb-2 text-xs text-red-600 bg-red-50 border border-red-200 rounded-lg px-3 py-2",children:be}),e.jsxs("form",{onSubmit:Ye,className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-slate-600 dark:text-slate-300 mb-1",children:"Monto"}),e.jsx("input",{type:"number",min:"1",className:"w-full p-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900/50 text-slate-800 dark:text-slate-200",value:b.amount,onChange:t=>P({...b,amount:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-slate-600 dark:text-slate-300 mb-1",children:"Tasa %"}),e.jsx("input",{type:"number",min:"0",step:"0.1",className:"w-full p-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900/50 text-slate-800 dark:text-slate-200",value:b.rate,onChange:t=>P({...b,rate:t.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-slate-600 dark:text-slate-300 mb-1",children:"Plazo"}),e.jsx("input",{type:"number",min:"1",className:"w-full p-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900/50 text-slate-800 dark:text-slate-200",value:b.term,onChange:t=>P({...b,term:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-slate-600 dark:text-slate-300 mb-1",children:"Frecuencia"}),e.jsxs("select",{className:"w-full p-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900/50 text-slate-800 dark:text-slate-200",value:b.frequency,onChange:t=>P({...b,frequency:t.target.value}),children:[e.jsx("option",{children:"Diario"}),e.jsx("option",{children:"Semanal"}),e.jsx("option",{children:"Quincenal"}),e.jsx("option",{children:"Mensual"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-slate-600 dark:text-slate-300 mb-1",children:"Fecha de inicio"}),e.jsx("input",{type:"date",className:"w-full p-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900/50 text-slate-800 dark:text-slate-200",value:b.startDate,onChange:t=>P({...b,startDate:t.target.value})})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx("button",{type:"button",onClick:()=>{J(!1),_("")},className:"px-4 py-2 rounded-lg bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-200 hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded-lg bg-blue-600 text-white font-semibold",children:"Guardar cambios"})]})]})]})}),Fe&&e.jsx("div",{className:"fixed inset-0 bg-slate-900/70 flex items-center justify-center z-50 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"w-full max-w-md bg-white dark:bg-slate-800 rounded-2xl shadow-2xl p-6 border border-slate-200 dark:border-slate-700",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-slate-100 mb-1",children:"Nuevo Pr√©stamo"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mb-3",children:"Crea un pr√©stamo directo para un cliente existente."}),pe&&e.jsx("p",{className:"mb-2 text-xs text-red-600 bg-red-50 border border-red-200 rounded-lg px-3 py-2",children:pe}),e.jsxs("form",{onSubmit:t=>{if(t.preventDefault(),!j)return;const l=parseFloat(d.amount||"0"),r=parseFloat(d.rate||"0"),n=parseInt(d.term||"0",10);if(!d.clientId||!l||!r||!n){ee("Completa todos los campos correctamente.");return}const x=parseFloat(d.closingCosts||"0");j({clientId:d.clientId,amount:l,rate:r,term:n,frequency:d.frequency,startDate:d.startDate,closingCosts:x,amortizationType:d.amortizationType}),q(!1),k({clientId:"",amount:"",rate:"20",term:"12",frequency:"Mensual",startDate:new Date().toISOString().split("T")[0],closingCosts:""}),ee("")},className:"space-y-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-slate-600 dark:text-slate-300 mb-1",children:"Cliente"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{className:"flex-1 p-2 text-sm border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900/50 text-slate-800 dark:text-slate-200",value:d.clientId,onChange:t=>k({...d,clientId:t.target.value}),children:[e.jsx("option",{value:"",children:"Selecciona un cliente"}),c.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),B&&e.jsx("button",{type:"button",onClick:()=>{q(!1),B()},className:"px-3 py-2 bg-emerald-500 hover:bg-emerald-600 text-white rounded-lg text-xs font-bold whitespace-nowrap",children:"+ Nuevo"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-slate-600 dark:text-slate-300 mb-1",children:"Monto"}),e.jsx("input",{type:"number",min:"1",className:"w-full p-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900/50 text-slate-800 dark:text-slate-200",value:d.amount,onChange:t=>k({...d,amount:t.target.value}),placeholder:"15000"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-semibold text-slate-600 dark:text-slate-300 mb-1",children:[d.amortizationType==="FIXED_PROFIT"&&"Ganancia (RD$)",d.amortizationType==="FIXED_PAYMENT"&&"Cuota Fija (RD$)",(d.amortizationType==="FLAT"||d.amortizationType==="FRENCH")&&"Tasa %"]}),e.jsx("input",{type:"number",min:"0",step:"0.1",className:"w-full p-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900/50 text-slate-800 dark:text-slate-200",value:d.rate,onChange:t=>k({...d,rate:t.target.value}),placeholder:d.amortizationType==="FIXED_PROFIT"?"2000":d.amortizationType==="FIXED_PAYMENT"?"1500":"20"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-slate-600 dark:text-slate-300 mb-1",children:"Plazo (cuotas)"}),e.jsx("input",{type:"number",min:"1",className:"w-full p-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900/50 text-slate-800 dark:text-slate-200",value:d.term,onChange:t=>k({...d,term:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-slate-600 dark:text-slate-300 mb-1",children:"Frecuencia"}),e.jsxs("select",{className:"w-full p-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900/50 text-slate-800 dark:text-slate-200",value:d.frequency,onChange:t=>k({...d,frequency:t.target.value}),children:[e.jsx("option",{children:"Diario"}),e.jsx("option",{children:"Semanal"}),e.jsx("option",{children:"Quincenal"}),e.jsx("option",{children:"Mensual"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-slate-600 dark:text-slate-300 mb-1",children:"Fecha inicio"}),e.jsx("input",{type:"date",className:"w-full p-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900/50 text-slate-800 dark:text-slate-200",value:d.startDate,onChange:t=>k({...d,startDate:t.target.value})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-semibold text-slate-600 dark:text-slate-300 mb-1",children:["Gastos de Cierre ",e.jsx("span",{className:"text-slate-400 font-normal",children:"(opcional)"})]}),e.jsx("input",{type:"number",min:"0",placeholder:"0",className:"w-full p-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900/50 text-slate-800 dark:text-slate-200",value:d.closingCosts,onChange:t=>k({...d,closingCosts:t.target.value})}),e.jsx("p",{className:"text-[10px] text-slate-400 mt-1",children:"Se suma al capital para calcular las cuotas"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-slate-600 dark:text-slate-300 mb-1",children:"Tipo de Inter√©s"}),e.jsxs("select",{className:"w-full p-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900/50 text-slate-800 dark:text-slate-200",value:d.amortizationType,onChange:t=>k({...d,amortizationType:t.target.value}),children:[e.jsx("option",{value:"FLAT",children:"Inter√©s Fijo (% sobre capital)"}),e.jsx("option",{value:"FIXED_PROFIT",children:"Ganancia Fija (monto a ganar)"}),e.jsx("option",{value:"FIXED_PAYMENT",children:"Cuota Fija (define monto cuota)"}),e.jsx("option",{value:"FRENCH",children:"Saldo Insoluto (bancos)"})]}),e.jsxs("p",{className:"text-[10px] text-slate-400 mt-1",children:[d.amortizationType==="FLAT"&&"Ej: 10,000 al 20% = 12,000 total",d.amortizationType==="FIXED_PROFIT"&&"Define cu√°nto quieres ganar en total",d.amortizationType==="FIXED_PAYMENT"&&"Define el monto exacto de cada cuota",d.amortizationType==="FRENCH"&&"Inter√©s sobre saldo restante (bancos)"]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{type:"button",className:"flex-1 bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 py-2 rounded-lg font-semibold hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors",onClick:()=>{q(!1),ee("")},children:"Cancelar"}),e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg font-semibold transition-colors",children:"Crear Pr√©stamo"})]})]})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100 flex items-center gap-2",children:[e.jsx(lt,{className:"w-6 h-6 text-blue-600"}),"Pr√©stamos y Cobros"]}),j&&e.jsxs("button",{onClick:()=>q(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-xl font-semibold text-sm flex items-center gap-2 transition-colors",children:[e.jsx(rt,{size:18})," Nuevo Pr√©stamo"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-xl bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800",children:[e.jsxs("p",{className:"text-xs text-blue-600 dark:text-blue-400 font-semibold flex items-center gap-1",children:[e.jsx(ne,{size:12})," Cartera"]}),e.jsx("p",{className:"text-lg font-bold text-blue-800 dark:text-blue-200",children:i(E.totalPortfolio)}),e.jsxs("p",{className:"text-xs text-blue-600",children:[E.activeCount," activos"]})]}),e.jsxs("div",{className:"p-3 rounded-xl bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-100 dark:border-emerald-800",children:[e.jsxs("p",{className:"text-xs text-emerald-600 dark:text-emerald-400 font-semibold flex items-center gap-1",children:[e.jsx(nt,{size:12})," Inter√©s Esperado"]}),e.jsx("p",{className:"text-lg font-bold text-emerald-800 dark:text-emerald-200",children:i(E.totalExpectedInterest)})]}),e.jsxs("div",{className:"p-3 rounded-xl bg-violet-50 dark:bg-violet-900/20 border border-violet-100 dark:border-violet-800",children:[e.jsxs("p",{className:"text-xs text-violet-600 dark:text-violet-400 font-semibold flex items-center gap-1",children:[e.jsx(dt,{size:12})," Por Cobrar"]}),e.jsx("p",{className:"text-lg font-bold text-violet-800 dark:text-violet-200",children:i(E.totalPending)})]}),e.jsxs("div",{className:"p-3 rounded-xl bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700",children:[e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400 font-semibold",children:"Por Tipo"}),e.jsxs("p",{className:"text-sm font-bold text-slate-800 dark:text-slate-200",children:[E.fixedCount," cuotas ¬∑ ",E.openCount," abiertos"]})]})]}),e.jsxs(Q,{children:[e.jsxs("div",{className:"flex flex-wrap gap-3 items-center",children:[e.jsx("div",{className:"flex-1 min-w-[180px]",children:e.jsx("input",{type:"text",placeholder:"Buscar cliente...",value:G,onChange:t=>Me(t.target.value),className:"w-full p-2 border border-slate-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-900/50 text-slate-800 dark:text-slate-200 placeholder:text-slate-400 text-sm"})}),e.jsxs("select",{value:V,onChange:t=>Oe(t.target.value),className:"p-2 border border-slate-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-900/50 text-slate-800 dark:text-slate-200 text-sm",children:[e.jsx("option",{value:"ALL",children:"Todos estados"}),e.jsx("option",{value:"ACTIVE",children:"Activos"}),e.jsx("option",{value:"COMPLETED",children:"Completados"}),e.jsx("option",{value:"DEFAULTED",children:"En mora"})]}),e.jsxs("select",{value:F,onChange:t=>Be(t.target.value),className:"p-2 border border-slate-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-900/50 text-slate-800 dark:text-slate-200 text-sm",children:[e.jsx("option",{value:"ALL",children:"Todos tipos"}),e.jsx("option",{value:"FIXED",children:"Cuotas fijas"}),e.jsx("option",{value:"OPEN",children:"Abonos libres"})]}),u.length>0&&e.jsxs("select",{value:H,onChange:t=>_e(t.target.value),className:"p-2 border border-slate-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-900/50 text-slate-800 dark:text-slate-200 text-sm",children:[e.jsx("option",{value:"ALL",children:"Todos cobradores"}),u.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsxs("select",{value:`${A}-${X}`,onChange:t=>{const[l,r]=t.target.value.split("-");Le(l),$e(r)},className:"p-2 border border-slate-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-900/50 text-slate-800 dark:text-slate-200 text-sm",children:[e.jsx("option",{value:"date-desc",children:"M√°s reciente"}),e.jsx("option",{value:"date-asc",children:"M√°s antiguo"}),e.jsx("option",{value:"amount-desc",children:"Mayor monto"}),e.jsx("option",{value:"amount-asc",children:"Menor monto"}),e.jsx("option",{value:"client-asc",children:"Cliente A-Z"}),e.jsx("option",{value:"client-desc",children:"Cliente Z-A"})]}),e.jsxs("button",{onClick:()=>Re(!S),className:`px-3 py-2 rounded-xl text-sm font-medium flex items-center gap-2 transition-all ${S?"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 border border-amber-300 dark:border-amber-700":"bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-400 border border-slate-300 dark:border-slate-600"}`,children:[e.jsx(ie,{size:14}),S?"Ocultar arch.":"Ver arch."]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 items-center mt-3 pt-3 border-t border-slate-100 dark:border-slate-700",children:[e.jsxs("span",{className:"text-xs text-slate-500 flex items-center gap-1",children:[e.jsx(ot,{size:12})," Rango de fecha:"]}),e.jsx("input",{type:"date",value:M,onChange:t=>ge(t.target.value),className:"p-2 border border-slate-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-900/50 text-slate-800 dark:text-slate-200 text-sm"}),e.jsx("span",{className:"text-xs text-slate-400",children:"a"}),e.jsx("input",{type:"date",value:O,onChange:t=>fe(t.target.value),className:"p-2 border border-slate-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-900/50 text-slate-800 dark:text-slate-200 text-sm"}),(M||O)&&e.jsx("button",{onClick:()=>{ge(""),fe("")},className:"text-xs text-blue-600 hover:underline",children:"Limpiar"}),e.jsxs("span",{className:"ml-auto text-sm text-slate-500 dark:text-slate-400",children:[Ne.length," de ",s.filter(t=>!t.archived).length]})]})]}),e.jsx(Q,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-800 text-slate-600 dark:text-slate-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-left",children:"Cliente"}),e.jsx("th",{className:"p-2 text-left",children:"Monto"}),e.jsx("th",{className:"p-2 text-left hidden md:table-cell",children:"Tasa"}),e.jsx("th",{className:"p-2 text-left hidden sm:table-cell",children:"Estado"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:[Ne.map(t=>{const l=c.find(x=>x.id===t.clientId),r=N===t.id,n=(l==null?void 0:l.documents)&&l.documents.length>0;return e.jsxs("tr",{onClick:()=>g&&g(t.id),className:`cursor-pointer transition-colors ${r?"bg-blue-50 dark:bg-blue-900/20":"hover:bg-slate-50 dark:hover:bg-slate-800/50"}`,children:[e.jsxs("td",{className:"p-2 text-slate-800 dark:text-slate-200 flex items-center gap-2",children:[(l==null?void 0:l.name)||"Sin cliente",n&&e.jsxs("span",{className:"bg-slate-200 dark:bg-slate-700 text-slate-600 dark:text-slate-300 rounded px-1.5 py-0.5 text-[10px] font-bold flex items-center gap-1",title:`${l.documents.length} documentos`,children:[e.jsx(we,{size:10})," ",l.documents.length]})]}),e.jsx("td",{className:"p-2 text-slate-800 dark:text-slate-200 font-medium",children:i(t.amount)}),e.jsxs("td",{className:"p-2 text-slate-600 dark:text-slate-400 hidden md:table-cell",children:[t.rate,"%"]}),e.jsx("td",{className:"p-2 hidden sm:table-cell",children:e.jsx(de,{status:t.status})})]},t.id)}),s.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"p-4 text-center text-slate-400",colSpan:4,children:"No hay pr√©stamos registrados."})})]})]})})}),a&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(Q,{className:"lg:col-span-1 order-1 lg:order-1",children:[e.jsx("h3",{className:"font-bold text-lg mb-3 text-slate-800 dark:text-slate-100",children:"Detalle del Pr√©stamo"}),p&&e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("p",{className:"text-sm text-slate-700 dark:text-slate-300",children:[e.jsx("span",{className:"font-semibold",children:"Cliente: "}),p.name]}),v&&e.jsxs("button",{onClick:()=>v(p.id),className:"flex items-center gap-1 px-2 py-1 text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-800/40 transition-colors",title:"Ver documentos del cliente",children:[e.jsx(we,{size:14}),"Documentos"]})]}),e.jsxs("p",{className:"text-sm text-slate-700 dark:text-slate-300 mb-1",children:[e.jsx("span",{className:"font-semibold",children:"Monto: "}),i(a.amount)]}),e.jsxs("p",{className:"text-sm text-slate-700 dark:text-slate-300 mb-1",children:[e.jsx("span",{className:"font-semibold",children:"Tasa: "}),a.rate,"%"]}),e.jsxs("p",{className:"text-sm text-slate-700 dark:text-slate-300 mb-1",children:[e.jsx("span",{className:"font-semibold",children:"Estado: "}),e.jsx(de,{status:a.status})]}),e.jsxs("p",{className:"text-sm text-slate-700 dark:text-slate-300 mb-1",children:[e.jsx("span",{className:"font-semibold",children:"Total Pagado: "}),i(a.totalPaid||0)]}),y&&e.jsxs("div",{className:"mt-4 p-3 bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 border-2 border-green-200 dark:border-green-800/50 rounded-xl text-sm shadow-sm",children:[e.jsx("p",{className:"font-bold text-green-800 dark:text-green-300 mb-2 text-base",children:"üí≥ Pr√≥xima cuota pendiente"}),e.jsxs("p",{className:"text-slate-700 dark:text-slate-300 mb-1",children:[e.jsxs("span",{className:"font-semibold",children:["Cuota #",y.number]})," ‚Ä¢ ",$(y.date)]}),e.jsxs("p",{className:"text-slate-700 dark:text-slate-300 mb-3",children:[e.jsx("span",{className:"font-semibold",children:"Monto: "}),i(y.payment)]}),e.jsx("button",{onClick:()=>{ze(""),Z({loanId:a.id,installmentId:y.id,amount:y.payment,number:y.number,date:y.date,clientName:(p==null?void 0:p.name)||"Sin cliente"})},className:"w-full bg-green-600 text-white py-2.5 rounded-lg font-bold text-sm hover:bg-green-700 shadow-md hover:shadow-lg transition-all",children:"‚úì Registrar Pago de esta Cuota"})]}),Array.isArray(a.schedule)&&a.schedule.some(t=>t.status==="PAID")?e.jsx("p",{className:"mt-4 text-xs text-slate-500 bg-slate-100 dark:bg-slate-800 p-2 rounded",children:"Este pr√©stamo ya tiene pagos registrados y no se puede editar."}):e.jsx("div",{className:"mt-4",children:e.jsx("button",{type:"button",onClick:We,className:"w-full bg-slate-900 dark:bg-slate-700 text-white py-2 rounded-lg font-bold text-sm hover:bg-slate-800 dark:hover:bg-slate-600 transition-colors",children:"Editar pr√©stamo"})}),e.jsx("div",{className:"mt-3",children:e.jsx("button",{onClick:Ke,disabled:w,className:"w-full bg-indigo-600 text-white py-2 rounded-lg font-bold text-sm hover:bg-indigo-700 disabled:opacity-50 flex justify-center items-center gap-2",children:w?"Generando...":"Generar Contrato Legal (IA)"})}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-200 dark:border-slate-700",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-2 font-medium",children:"Acciones del pr√©stamo"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[a.status==="ACTIVE"&&e.jsxs("button",{onClick:()=>Y(!0),className:"flex flex-col items-center gap-1 p-2 rounded-lg bg-amber-50 dark:bg-amber-900/20 text-amber-700 dark:text-amber-400 hover:bg-amber-100 dark:hover:bg-amber-900/30 transition-colors text-xs",children:[e.jsx(oe,{size:18}),"Cancelar"]}),e.jsxs("button",{onClick:()=>K(!0),className:"flex flex-col items-center gap-1 p-2 rounded-lg bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors text-xs",children:[e.jsx(ie,{size:18}),a.archived?"Desarchivar":"Archivar"]}),!Array.isArray(a.schedule)||!a.schedule.some(t=>t.status==="PAID")?e.jsxs("button",{onClick:()=>je(!0),className:"flex flex-col items-center gap-1 p-2 rounded-lg bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors text-xs",children:[e.jsx(Ce,{size:18}),"Eliminar"]}):null]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mt-2",children:[a.status==="COMPLETED"&&e.jsxs("button",{onClick:()=>te(!0),className:"flex flex-col items-center gap-1 p-2 rounded-lg bg-emerald-50 dark:bg-emerald-900/20 text-emerald-700 dark:text-emerald-400 hover:bg-emerald-100 dark:hover:bg-emerald-900/30 transition-colors text-xs",children:[e.jsx(Ie,{size:18}),"Renovar"]}),a.status==="ACTIVE"&&e.jsxs("button",{onClick:()=>ae(!0),className:"flex flex-col items-center gap-1 p-2 rounded-lg bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-400 hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors text-xs",children:[e.jsx(ne,{size:18}),"Refinanciar"]}),e.jsxs("button",{onClick:()=>W({show:!0,loanId:a.id,notes:a.notes||""}),className:"flex flex-col items-center gap-1 p-2 rounded-lg bg-violet-50 dark:bg-violet-900/20 text-violet-700 dark:text-violet-400 hover:bg-violet-100 dark:hover:bg-violet-900/30 transition-colors text-xs",children:[e.jsx(Pe,{size:18}),"Notas"]})]})]})]}),e.jsxs(Q,{className:"lg:col-span-2 order-2 lg:order-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:"font-bold text-lg text-slate-800 dark:text-slate-100",children:"Hoja de amortizaci√≥n"}),e.jsxs("button",{onClick:Qe,className:"flex items-center gap-1 px-3 py-1.5 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition-colors",title:"Imprimir hoja de amortizaci√≥n",children:[e.jsx(ce,{size:16}),"Imprimir"]})]}),e.jsx("div",{className:"overflow-x-auto max-h-[360px]",children:e.jsxs("table",{className:"w-full text-xs md:text-sm",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-800 text-slate-600 dark:text-slate-300 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-left",children:"#"}),e.jsx("th",{className:"p-2 text-left",children:"Fecha"}),e.jsx("th",{className:"p-2 text-right",children:"Cuota"}),e.jsx("th",{className:"p-2 text-right",children:"Inter√©s"}),e.jsx("th",{className:"p-2 text-right",children:"Capital"}),e.jsx("th",{className:"p-2 text-right",children:"Saldo"}),e.jsx("th",{className:"p-2 text-right",children:"Estado"}),e.jsx("th",{className:"p-2 text-center",children:"Acciones"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:a.schedule.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"p-2 text-slate-800 dark:text-slate-300",children:t.number}),e.jsx("td",{className:"p-2 text-slate-600 dark:text-slate-400",children:$(t.date)}),e.jsx("td",{className:"p-2 text-right text-slate-800 dark:text-slate-200",children:i(t.payment)}),e.jsx("td",{className:"p-2 text-right text-red-500 dark:text-red-400",children:i(t.interest??0)}),e.jsx("td",{className:"p-2 text-right text-green-600 dark:text-green-400",children:i(t.principal??0)}),e.jsx("td",{className:"p-2 text-right text-slate-500 dark:text-slate-400",children:i(t.balance??0)}),e.jsx("td",{className:"p-2 text-right",children:e.jsx(de,{status:t.status==="PAID"?"PAID":"PENDING"})}),e.jsx("td",{className:"p-2 text-center",children:t.status==="PAID"&&e.jsxs("button",{onClick:()=>he({id:t.id||`inst-${t.number}`,date:t.paidAt||t.date,clientName:(p==null?void 0:p.name)||"Cliente",amount:t.payment,installmentNumber:t.number,remainingBalance:t.balance,loanId:a.id,penalty:0,total:t.payment}),className:"text-xs text-blue-600 hover:text-blue-800 dark:text-blue-400 flex items-center gap-1 mx-auto",title:"Reimprimir recibo",children:[e.jsx(ce,{size:14})," Copia"]})})]},t.id))})]})})]})]}),ue&&e.jsx(ct,{receipt:ue,onClose:()=>he(null),isCopy:!0}),Ve&&a&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-2xl p-6 w-full max-w-sm animate-fade-in",children:[e.jsxs("h3",{className:"text-lg font-bold text-amber-600 dark:text-amber-400 mb-3 flex items-center gap-2",children:[e.jsx(oe,{size:20})," Cancelar Pr√©stamo"]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:"¬øEst√°s seguro de cancelar este pr√©stamo? Solo se puede cancelar si no tiene pagos registrados."}),e.jsx("input",{type:"text",value:ve,onChange:t=>se(t.target.value),placeholder:"Raz√≥n de cancelaci√≥n (opcional)",className:"w-full p-3 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900 text-slate-800 dark:text-slate-200 mb-4"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{Y(!1),se("")},className:"flex-1 py-2.5 rounded-lg font-semibold bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300",children:"No, volver"}),e.jsx("button",{onClick:async()=>{D(!0);try{await U.cancel(a.id,ve||"Cancelado por usuario"),Y(!1),se(""),window.location.reload()}catch(t){Y(!1),le({show:!0,message:t.message||"Error al cancelar pr√©stamo"}),D(!1)}},disabled:T,className:"flex-1 py-2.5 rounded-lg font-semibold bg-amber-600 text-white hover:bg-amber-500 disabled:opacity-50",children:T?"Cancelando...":"S√≠, cancelar"})]})]})}),Xe&&a&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-2xl p-6 w-full max-w-sm animate-fade-in",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-800 dark:text-slate-100 mb-3 flex items-center gap-2",children:[e.jsx(ie,{size:20})," ",a.archived?"Desarchivar":"Archivar"," Pr√©stamo"]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:a.archived?"Este pr√©stamo volver√° a aparecer en la lista principal.":"El pr√©stamo se ocultar√° de la vista principal pero no se eliminar√°."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>K(!1),className:"flex-1 py-2.5 rounded-lg font-semibold bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300",children:"Cancelar"}),e.jsx("button",{onClick:async()=>{D(!0);try{a.archived?await U.unarchive(a.id):await U.archive(a.id),K(!1),window.location.reload()}catch(t){K(!1),le({show:!0,message:t.message||"Error al archivar pr√©stamo"}),D(!1)}},disabled:T,className:"flex-1 py-2.5 rounded-lg font-semibold bg-slate-800 dark:bg-slate-600 text-white hover:bg-slate-700",children:T?"Procesando...":a.archived?"Desarchivar":"Archivar"})]})]})}),He&&a&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-2xl p-6 w-full max-w-sm animate-fade-in",children:[e.jsxs("h3",{className:"text-lg font-bold text-red-600 dark:text-red-400 mb-3 flex items-center gap-2",children:[e.jsx(Ce,{size:20})," Eliminar Pr√©stamo"]}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-2",children:["‚ö†Ô∏è ",e.jsx("strong",{children:"Esta acci√≥n es irreversible."})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:"Se eliminar√° permanentemente el pr√©stamo y todos sus datos asociados."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>je(!1),className:"flex-1 py-2.5 rounded-lg font-semibold bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300",children:"No, volver"}),e.jsx("button",{onClick:async()=>{D(!0);try{await U.delete(a.id),g==null||g(null),window.location.reload()}catch(t){alert(t.message||"Error al eliminar")}finally{D(!1)}},disabled:T,className:"flex-1 py-2.5 rounded-lg font-semibold bg-red-600 text-white hover:bg-red-500 disabled:opacity-50",children:T?"Eliminando...":"S√≠, eliminar"})]})]})}),qe&&a&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-2xl p-6 w-full max-w-sm animate-fade-in",children:[e.jsxs("h3",{className:"text-lg font-bold text-emerald-600 dark:text-emerald-400 mb-3 flex items-center gap-2",children:[e.jsx(Ie,{size:20})," Renovar Pr√©stamo"]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:"Este pr√©stamo est√° completado. ¬øDeseas crear un nuevo pr√©stamo para el mismo cliente con las mismas condiciones?"}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-700 rounded-lg p-3 mb-4 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Cliente:"})," ",p==null?void 0:p.name]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Monto anterior:"})," ",i(a.amount)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Tasa:"})," ",a.rate,"%"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Plazo:"})," ",a.term," cuotas"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>te(!1),className:"flex-1 py-2.5 rounded-lg font-semibold bg-slate-200 dark:bg-slate-600 text-slate-700 dark:text-slate-200 hover:bg-slate-300",children:"Cancelar"}),e.jsx("button",{onClick:()=>{j&&j({clientId:a.clientId,amount:a.amount,rate:a.rate,term:a.term,frequency:a.frequency,amortizationType:a.amortizationType,renewedFrom:a.id}),te(!1)},className:"flex-1 py-2.5 rounded-lg font-semibold bg-emerald-600 text-white hover:bg-emerald-500",children:"Crear Nuevo Pr√©stamo"})]})]})}),Ge&&a&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-2xl p-6 w-full max-w-sm animate-fade-in",children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-600 dark:text-blue-400 mb-3 flex items-center gap-2",children:[e.jsx(ne,{size:20})," Refinanciar Pr√©stamo"]}),e.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:["Consolidar el saldo pendiente (",i(a.currentBalance||parseFloat(a.amount)*(1+parseFloat(a.rate)/100)-(a.totalPaid||0)),") en un nuevo pr√©stamo."]}),e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-700 rounded-lg p-3 mb-4 text-sm text-amber-800 dark:text-amber-300",children:[e.jsx("p",{className:"font-semibold",children:"‚ö†Ô∏è Advertencia:"}),e.jsx("p",{children:"Al refinanciar, el pr√©stamo actual se marcar√° como completado y se crear√° uno nuevo con el saldo pendiente."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>ae(!1),className:"flex-1 py-2.5 rounded-lg font-semibold bg-slate-200 dark:bg-slate-600 text-slate-700 dark:text-slate-200 hover:bg-slate-300",children:"Cancelar"}),e.jsx("button",{onClick:()=>{const t=a.currentBalance||parseFloat(a.amount)*(1+parseFloat(a.rate)/100)-(a.totalPaid||0);j&&j({clientId:a.clientId,amount:t,rate:a.rate,term:a.term,frequency:a.frequency,startDate:new Date().toISOString().split("T")[0],amortizationType:a.amortizationType||"FRENCH",refinancedFrom:a.id}),ae(!1)},className:"flex-1 py-2.5 rounded-lg font-semibold bg-blue-600 text-white hover:bg-blue-500",children:"Refinanciar"})]})]})}),R.show&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-2xl p-6 w-full max-w-md animate-fade-in",children:[e.jsxs("h3",{className:"text-lg font-bold text-violet-600 dark:text-violet-400 mb-3 flex items-center gap-2",children:[e.jsx(Pe,{size:20})," Notas del Pr√©stamo"]}),e.jsx("textarea",{value:R.notes,onChange:t=>W({...R,notes:t.target.value}),placeholder:"Agrega observaciones, comentarios o informaci√≥n importante sobre este pr√©stamo...",className:"w-full p-3 border border-slate-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-900/50 text-slate-800 dark:text-slate-200 min-h-[120px] text-sm"}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx("button",{onClick:()=>W({show:!1,loanId:null,notes:""}),className:"flex-1 py-2.5 rounded-lg font-semibold bg-slate-200 dark:bg-slate-600 text-slate-700 dark:text-slate-200 hover:bg-slate-300",children:"Cancelar"}),e.jsx("button",{onClick:()=>{f&&a&&f({...a,notes:R.notes}),W({show:!1,loanId:null,notes:""})},className:"flex-1 py-2.5 rounded-lg font-semibold bg-violet-600 text-white hover:bg-violet-500",children:"Guardar Notas"})]})]})}),(a==null?void 0:a.history)&&a.history.length>0&&R.show&&e.jsxs("div",{className:"fixed bottom-4 right-4 bg-white dark:bg-slate-800 rounded-xl shadow-lg p-4 max-w-xs z-40 border border-slate-200 dark:border-slate-700",children:[e.jsxs("h4",{className:"text-sm font-bold text-slate-700 dark:text-slate-300 mb-2 flex items-center gap-1",children:[e.jsx(it,{size:14})," Historial de cambios"]}),e.jsx("ul",{className:"text-xs text-slate-500 dark:text-slate-400 space-y-1 max-h-32 overflow-y-auto",children:a.history.slice(-5).map((t,l)=>e.jsxs("li",{children:[$(t.date)," - ",t.action]},l))})]}),ke.show&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-2xl p-6 w-full max-w-sm animate-fade-in",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-red-100 dark:bg-red-900/30 rounded-full",children:e.jsx(oe,{className:"w-6 h-6 text-red-600 dark:text-red-400"})}),e.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-slate-100",children:"Error"})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:ke.message}),e.jsx("button",{onClick:()=>le({show:!1,message:""}),className:"w-full py-2.5 rounded-lg font-semibold bg-slate-800 dark:bg-slate-600 text-white hover:bg-slate-700",children:"Entendido"})]})})]})}function Dt(s){const c=[];s.clientId||c.push("Debe seleccionar un cliente"),(!s.amount||parseFloat(s.amount)<=0)&&c.push("El monto debe ser mayor a 0"),(s.rate===void 0||parseFloat(s.rate)<0)&&c.push("La tasa de inter√©s no puede ser negativa"),(!s.term||parseInt(s.term)<1)&&c.push("El plazo debe ser al menos 1 cuota");const u=["Diario","Semanal","Quincenal","Mensual"];return s.frequency&&!u.includes(s.frequency)&&c.push("Frecuencia de pago no v√°lida"),s.startDate||c.push("La fecha de inicio es requerida"),{valid:c.length===0,errors:c}}function Et(s){const c=parseFloat(s.amount)||0,u=parseFloat(s.rate)||0,h=parseInt(s.term)||1;return{clientId:s.clientId,amount:c,rate:u,term:h,frequency:s.frequency||"Mensual",startDate:s.startDate||new Date().toISOString().split("T")[0],status:"ACTIVE",totalPaid:0,totalInterest:c*(u/100)}}function zt(s){if(!s.schedule||s.schedule.length===0)return 0;const c=s.schedule.filter(u=>u.status==="PAID").length;return Math.round(c/s.schedule.length*100)}function St(s){return s.schedule&&s.schedule.find(c=>c.status!=="PAID")||null}function Ft(s){if(!s.schedule)return 0;const c=new Date;return c.setHours(0,0,0,0),s.schedule.filter(u=>{const h=new Date(u.date);return u.status!=="PAID"&&h<c}).length}export{Tt as LoansView,Et as createLoan,zt as getLoanProgress,St as getNextInstallment,Ft as getOverdueCount,U as loanApi,Dt as validateLoan};
