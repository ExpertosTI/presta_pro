import{c as h,p as n,j as e,B as j,q as W,C as N,M as P,d as G}from"./index-d07a4565.js";import{N as ne}from"./index-d07a4565.js";import{r as l}from"./vendor-8a332d8f.js";import{A as M}from"./alert-triangle-f3e24c64.js";import{C as H}from"./calendar-da7962d8.js";import{C as F}from"./clock-0f83d6c6.js";import{T as J}from"./trash-2-8bdf2c52.js";const K=h("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]),Q=h("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),X=h("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),Z=h("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]]),U={PAYMENT_DUE:"ðŸ’°",PAYMENT_RECEIVED:"âœ…",REPORT:"ðŸ“Š",SYSTEM:"âš™ï¸",SUBSCRIPTION:"ðŸ’³",OVERDUE:"âš ï¸"},I={PAYMENT_DUE:"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400",PAYMENT_RECEIVED:"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-400",REPORT:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",SYSTEM:"bg-slate-100 text-slate-800 dark:bg-slate-700 dark:text-slate-300",SUBSCRIPTION:"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400",OVERDUE:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"},w={PAYMENT_DUE:"Pagos Pendientes",PAYMENT_RECEIVED:"Pagos Recibidos",REPORT:"Reportes",SYSTEM:"Sistema",SUBSCRIPTION:"SuscripciÃ³n",OVERDUE:"Mora"};function le({showToast:r,systemSettings:m}){const[b,i]=l.useState([]),[x,c]=l.useState(0),[k,v]=l.useState(!0),[g,D]=l.useState("all"),[d,p]=l.useState(null),[y,E]=l.useState(!1),[f,z]=l.useState(null),[o,$]=l.useState(!1);l.useEffect(()=>{Y(),_()},[]);const Y=async()=>{try{v(!0);const a=await n.getNotifications();i(a.notifications||[]),c(a.unreadCount||0)}catch(a){console.error("Error loading notifications:",a)}finally{v(!1)}},_=async()=>{try{const a=await n.getEmailPreferences();p(a)}catch(a){console.error("Error loading preferences:",a)}},B=async a=>{try{await n.markAsRead(a),i(t=>t.map(s=>s.id===a?{...s,read:!0}:s)),c(t=>Math.max(0,t-1))}catch{r==null||r("Error al marcar como leÃ­da","error")}},V=async()=>{try{await n.markAllAsRead(),i(a=>a.map(t=>({...t,read:!0}))),c(0),r==null||r("Todas las notificaciones marcadas como leÃ­das","success")}catch{r==null||r("Error al marcar todas","error")}},C=async a=>{try{await n.deleteNotification(a),i(t=>t.filter(s=>s.id!==a)),r==null||r("NotificaciÃ³n eliminada","success")}catch{r==null||r("Error al eliminar","error")}},L=async()=>{try{E(!0),await n.updateEmailPreferences(d),r==null||r("Preferencias guardadas","success")}catch{r==null||r("Error guardando preferencias","error")}finally{E(!1)}},q=async()=>{const a=(d==null?void 0:d.reportEmail)||prompt("Ingresa email para prueba:");if(a)try{await n.sendTestEmail(a),r==null||r("Email de prueba enviado","success")}catch{r==null||r("Error enviando email","error")}},A=a=>{const t=(m==null?void 0:m.companyWhatsApp)||"";if(!t){r==null||r("Configure el WhatsApp de empresa en Ajustes","error");return}const s=encodeURIComponent(`Recordatorio: ${a.title}
${a.message}`);window.open(`https://wa.me/${t.replace(/\D/g,"")}?text=${s}`,"_blank")},S=a=>{f===a.id?a.actionUrl&&(window.location.href=a.actionUrl):(z(a.id),a.read||B(a.id))},u=g==="unread"?b.filter(a=>!a.read):b,R=l.useMemo(()=>{if(!o)return null;const a={};return u.forEach(t=>{const s=t.type||"SYSTEM";a[s]||(a[s]=[]),a[s].push(t)}),a},[u,o]);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-blue-100 dark:bg-blue-900/30 rounded-xl",children:e.jsx(j,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:"Notificaciones"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:x>0?`${x} sin leer`:"Todo al dÃ­a"})]})]}),x>0&&e.jsxs("button",{onClick:V,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(K,{size:18}),"Marcar todas como leÃ­das"]})]}),e.jsx("div",{className:"flex gap-2 border-b border-slate-200 dark:border-slate-700",children:[{id:"all",label:"Todas",icon:j},{id:"unread",label:"Sin leer",icon:M,count:x},{id:"preferences",label:"Preferencias",icon:W}].map(a=>e.jsxs("button",{onClick:()=>D(a.id),className:`flex items-center gap-2 px-4 py-3 font-medium transition-colors border-b-2 ${g===a.id?"border-blue-600 text-blue-600 dark:text-blue-400":"border-transparent text-slate-500 hover:text-slate-700 dark:text-slate-400"}`,children:[e.jsx(a.icon,{size:18}),a.label,a.count>0&&e.jsx("span",{className:"px-2 py-0.5 bg-red-500 text-white text-xs rounded-full",children:a.count})]},a.id))}),g==="preferences"?e.jsxs(N,{children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-800 dark:text-slate-100 mb-6 flex items-center gap-2",children:[e.jsx(P,{size:20}),"Preferencias de Email"]}),d?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-slate-700 dark:text-slate-300 mb-4 flex items-center gap-2",children:[e.jsx(H,{size:18}),"Reportes AutomÃ¡ticos"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[{key:"dailyReport",label:"Diario",desc:"Resumen cada dÃ­a"},{key:"weeklyReport",label:"Semanal",desc:"Cada lunes"},{key:"monthlyReport",label:"Mensual",desc:"Primer dÃ­a del mes"}].map(a=>e.jsxs("label",{className:"flex items-start gap-3 p-4 bg-slate-50 dark:bg-slate-800 rounded-xl cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:d[a.key]||!1,onChange:t=>p(s=>({...s,[a.key]:t.target.checked})),className:"mt-1 w-5 h-5 rounded text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-800 dark:text-slate-200",children:a.label}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:a.desc})]})]},a.key))})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-slate-700 dark:text-slate-300 mb-4 flex items-center gap-2",children:[e.jsx(M,{size:18}),"Alertas"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[{key:"paymentReminders",label:"Recordatorios de pago",desc:"Antes del vencimiento"},{key:"overdueAlerts",label:"Alertas de mora",desc:"Cuotas vencidas"},{key:"subscriptionAlerts",label:"SuscripciÃ³n",desc:"Vencimiento prÃ³ximo"}].map(a=>e.jsxs("label",{className:"flex items-start gap-3 p-4 bg-slate-50 dark:bg-slate-800 rounded-xl cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:d[a.key]||!1,onChange:t=>p(s=>({...s,[a.key]:t.target.checked})),className:"mt-1 w-5 h-5 rounded text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-800 dark:text-slate-200",children:a.label}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:a.desc})]})]},a.key))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:[e.jsx(F,{size:16,className:"inline mr-2"}),"Hora de envÃ­o de reportes"]}),e.jsx("select",{value:d.reportHour||8,onChange:a=>p(t=>({...t,reportHour:parseInt(a.target.value)})),className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-800 dark:text-slate-200",children:Array.from({length:24},(a,t)=>e.jsxs("option",{value:t,children:[t.toString().padStart(2,"0"),":00"]},t))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:[e.jsx(P,{size:16,className:"inline mr-2"}),"Email alternativo para reportes"]}),e.jsx("input",{type:"email",value:d.reportEmail||"",onChange:a=>p(t=>({...t,reportEmail:a.target.value})),placeholder:"Dejar vacÃ­o para usar email principal",className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-800 dark:text-slate-200"})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4 border-t border-slate-200 dark:border-slate-700",children:[e.jsx("button",{onClick:L,disabled:y,className:"px-6 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 transition-colors",children:y?"Guardando...":"Guardar Preferencias"}),e.jsx("button",{onClick:q,className:"px-6 py-2 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-lg font-medium hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors",children:"Enviar Email de Prueba"})]})]}):e.jsx("p",{className:"text-slate-500 text-center py-8",children:"Cargando preferencias..."})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm text-slate-500",children:[u.length," notificaciones"]}),e.jsx("button",{onClick:()=>$(!o),className:`text-sm px-3 py-1 rounded-lg transition-colors ${o?"bg-blue-100 text-blue-700":"bg-slate-100 text-slate-600"}`,children:o?"âœ“ Agrupado por tipo":"Agrupar por tipo"})]}),k?e.jsx(N,{children:e.jsx("p",{className:"text-center text-slate-500 py-8",children:"Cargando notificaciones..."})}):u.length===0?e.jsx(N,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(j,{className:"w-12 h-12 text-slate-300 dark:text-slate-600 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:g==="unread"?"No hay notificaciones sin leer":"No hay notificaciones"})]})}):o&&R?Object.entries(R).map(([a,t])=>e.jsxs("div",{className:"mb-4",children:[e.jsxs("h3",{className:"text-sm font-bold text-slate-600 dark:text-slate-400 mb-2 flex items-center gap-2",children:[e.jsx("span",{children:U[a]||"ðŸ“Œ"}),w[a]||a," (",t.length,")"]}),e.jsx("div",{className:"space-y-2",children:t.map(s=>e.jsx(O,{notification:s,expandedId:f,handleNotificationClick:S,handleWhatsAppReminder:A,handleDelete:C},s.id))})]},a)):u.map(a=>e.jsx(O,{notification:a,expandedId:f,handleNotificationClick:S,handleWhatsAppReminder:A,handleDelete:C},a.id))]})]})}function O({notification:r,expandedId:m,handleNotificationClick:b,handleWhatsAppReminder:i,handleDelete:x}){const c=m===r.id;return e.jsx("div",{onClick:()=>b(r),className:`p-4 rounded-xl border transition-all cursor-pointer active:scale-[0.98] ${r.read?"bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700":"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800"} ${c?"ring-2 ring-blue-500":""}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg shrink-0 ${I[r.type]||I.SYSTEM}`,children:e.jsx("span",{className:"text-xl",children:U[r.type]||"ðŸ“Œ"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h4",{className:`font-semibold ${r.read?"text-slate-700 dark:text-slate-300":"text-slate-900 dark:text-slate-100"}`,children:r.title}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[e.jsx("span",{className:"text-xs text-slate-400 whitespace-nowrap",children:G(r.createdAt)}),c?e.jsx(X,{size:14,className:"text-blue-500"}):e.jsx(Q,{size:14,className:"text-slate-400"})]})]}),e.jsx("p",{className:`text-sm text-slate-600 dark:text-slate-400 mt-1 ${c?"":"line-clamp-2"}`,children:r.message}),c&&e.jsxs("div",{className:"flex flex-wrap gap-2 mt-3 pt-3 border-t border-slate-200 dark:border-slate-700",onClick:k=>k.stopPropagation(),children:[r.actionUrl&&e.jsx("a",{href:r.actionUrl,className:"flex-1 py-2 px-3 bg-blue-600 text-white text-sm font-medium rounded-lg text-center hover:bg-blue-700",children:"Abrir â†’"}),e.jsxs("button",{onClick:()=>i(r),className:"py-2 px-3 bg-green-500 text-white text-sm font-medium rounded-lg flex items-center gap-1 hover:bg-green-600",children:[e.jsx(Z,{size:14}),"WhatsApp"]}),e.jsx("button",{onClick:()=>x(r.id),className:"py-2 px-3 bg-red-100 text-red-600 text-sm font-medium rounded-lg hover:bg-red-200",children:e.jsx(J,{size:14})})]})]})]})})}export{ne as NotificationBell,le as NotificationsView,n as notificationService};
