import{i as u,j as e,C as g,a as L,b as q,U as B,F as G}from"./index-d07a4565.js";import{r as d}from"./vendor-8a332d8f.js";import{C as J}from"./credit-card-9381f742.js";import{A as O}from"./alert-triangle-f3e24c64.js";import{S as _}from"./star-7ffeefff.js";import{U as I}from"./upload-5b885fb0.js";import{C as H}from"./calendar-da7962d8.js";const K=async()=>await u.get("/subscriptions/my-subscription"),Q=async()=>await u.get("/subscriptions/plans"),W=async(s,t)=>await u.post("/subscriptions/create-intent",{planId:s,interval:t}),X=async s=>await u.post("/subscriptions/upload-proof",s,{headers:{"Content-Type":"multipart/form-data"}}),Y=async()=>await u.post("/subscriptions/cancel"),P={getMySubscription:K,getPlans:Q,createPaymentIntent:W,uploadPaymentProof:X,cancelSubscription:Y};function ne({showToast:s}){var D,R,z,M,$,U;const[t,l]=d.useState(null),[x,m]=d.useState([]),[c,n]=d.useState(!0),[h,E]=d.useState(!1),[f,S]=d.useState(!1),[r,j]=d.useState(null),[i,y]=d.useState("quarterly");d.useEffect(()=>{w()},[]);const w=async()=>{try{n(!0);const[a,o]=await Promise.all([P.getMySubscription(),P.getPlans()]);l(a),m(o)}catch(a){console.error("Error loading subscription data:",a),s==null||s("Error cargando informaciÃ³n de suscripciÃ³n","error")}finally{n(!1)}},V=async a=>{const o=a.target.files[0];if(!o)return;if(o.size>5*1024*1024){s==null||s("El archivo no debe superar los 5MB","error");return}if(!r){s==null||s("Por favor selecciona un plan primero","error");return}let v=r.monthlyPrice,k="monthly";i==="quarterly"?(v=r.quarterlyPrice||r.monthlyPrice*3,k="quarterly"):i==="yearly"&&(v=r.yearlyPrice||r.monthlyPrice*12,k="yearly");try{S(!0);const p=new FormData;p.append("proof",o),p.append("plan",r.id),p.append("amount",v.toString()),p.append("interval",k),await P.uploadPaymentProof(p),s==null||s("Comprobante subido exitosamente. Esperando verificaciÃ³n.","success"),j(null),w()}catch{s==null||s("Error subiendo comprobante","error")}finally{S(!1)}};if(c)return e.jsx(g,{children:e.jsx("p",{className:"text-center text-slate-500 py-8",children:"Cargando suscripciÃ³n..."})});const b=(t==null?void 0:t.plan)||"FREE",N=b==="MASTER",A=b!=="FREE",F=N?"ACTIVE":(t==null?void 0:t.status)||"ACTIVE";return t!=null&&t.daysRemaining,e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-fuchsia-100 dark:bg-fuchsia-900/30 rounded-xl",children:e.jsx(J,{className:"w-6 h-6 text-fuchsia-600 dark:text-fuchsia-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:"Mi SuscripciÃ³n"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Gestiona tu plan y facturaciÃ³n"})]})]}),e.jsx(g,{className:"border-l-4 border-fuchsia-500",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-6 justify-between items-start md:items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-slate-500 uppercase tracking-wider",children:"Plan Actual"}),F==="ACTIVE"?e.jsxs("span",{className:"px-2 py-0.5 bg-green-100 text-green-700 text-xs rounded-full flex items-center gap-1",children:[e.jsx(L,{size:10})," Activo"]}):e.jsxs("span",{className:"px-2 py-0.5 bg-amber-100 text-amber-700 text-xs rounded-full flex items-center gap-1",children:[e.jsx(O,{size:10})," ",F]})]}),e.jsx("h3",{className:"text-3xl font-bold text-slate-900 dark:text-white mb-1",children:b}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:N?"Cuenta propietario - Acceso completo sin restricciones":A?`RenovaciÃ³n: ${q(t==null?void 0:t.currentPeriodEnd)}`:"Actualiza a PRO para desbloquear todas las funciones"})]}),e.jsx("div",{className:"flex gap-3",children:N?null:A?e.jsx("button",{className:"px-4 py-2 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors",onClick:()=>E(!h),children:"Cambiar Plan"}):e.jsxs("button",{onClick:()=>E(!h),className:"px-6 py-2.5 bg-gradient-to-r from-fuchsia-600 to-purple-600 text-white rounded-lg font-medium shadow-lg shadow-purple-200 dark:shadow-none hover:shadow-xl hover:scale-105 transition-all flex items-center gap-2",children:[e.jsx(_,{size:18,className:"fill-current"}),"Actualizar a PRO"]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(C,{label:"Clientes",used:((D=t==null?void 0:t._count)==null?void 0:D.clients)||0,limit:((R=t==null?void 0:t.limits)==null?void 0:R.maxClients)||50,icon:B}),e.jsx(C,{label:"PrÃ©stamos Activos",used:((z=t==null?void 0:t._count)==null?void 0:z.loans)||0,limit:((M=t==null?void 0:t.limits)==null?void 0:M.maxLoans)||20,icon:G}),e.jsx(C,{label:"Almacenamiento",used:(t==null?void 0:t.storageUsed)||0,limit:(($=t==null?void 0:t.limits)==null?void 0:$.storageLimit)||100,unit:"MB",icon:I})]}),h&&e.jsxs("div",{className:"mt-8 animate-fade-in-up",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-white mb-6 text-center",children:"Planes Disponibles"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:x.map(a=>e.jsx(Z,{plan:a,isCurrent:b===a.id,onSelect:o=>j(o)},a.id))})]}),r&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-6 max-w-md w-full",children:[e.jsxs("h3",{className:"text-xl font-bold text-slate-800 dark:text-white mb-2",children:["Selecciona el perÃ­odo para ",r.name]}),r.promoLabel&&e.jsx("p",{className:"text-sm text-orange-600 dark:text-orange-400 mb-4 font-medium",children:r.promoLabel}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsxs("label",{className:`flex items-center justify-between p-4 rounded-xl cursor-pointer transition-all ${i==="monthly"?"bg-indigo-50 dark:bg-indigo-900/30 border-2 border-indigo-500":"bg-slate-50 dark:bg-slate-700 border-2 border-transparent"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"radio",name:"period",value:"monthly",checked:i==="monthly",onChange:()=>y("monthly"),className:"w-4 h-4 text-indigo-600"}),e.jsx("span",{className:"font-medium",children:"Mensual"})]}),e.jsx("span",{className:"font-bold text-slate-800 dark:text-white",children:r.monthlyPriceFormatted})]}),e.jsxs("label",{className:`flex items-center justify-between p-4 rounded-xl cursor-pointer transition-all relative ${i==="quarterly"?"bg-orange-50 dark:bg-orange-900/30 border-2 border-orange-500":"bg-slate-50 dark:bg-slate-700 border-2 border-transparent"}`,children:[e.jsx("span",{className:"absolute -top-2 left-4 px-2 py-0.5 bg-orange-500 text-white text-xs font-bold rounded-full",children:"ðŸ”¥ OFERTA"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"radio",name:"period",value:"quarterly",checked:i==="quarterly",onChange:()=>y("quarterly"),className:"w-4 h-4 text-orange-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"3 Meses"}),e.jsxs("p",{className:"text-xs text-slate-500",children:[r.promoPriceFormatted," fijo todo el aÃ±o"]})]})]}),e.jsx("span",{className:"font-bold text-orange-600",children:r.quarterlyPriceFormatted})]}),e.jsxs("label",{className:`flex items-center justify-between p-4 rounded-xl cursor-pointer transition-all ${i==="yearly"?"bg-indigo-50 dark:bg-indigo-900/30 border-2 border-indigo-500":"bg-slate-50 dark:bg-slate-700 border-2 border-transparent"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"radio",name:"period",value:"yearly",checked:i==="yearly",onChange:()=>y("yearly"),className:"w-4 h-4 text-indigo-600"}),e.jsx("span",{className:"font-medium",children:"Anual"})]}),e.jsx("span",{className:"font-bold text-slate-800 dark:text-white",children:r.yearlyPriceFormatted})]})]}),e.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-700 rounded-xl text-center mb-4",children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-3",children:"Sube tu comprobante de transferencia"}),e.jsxs("label",{className:`cursor-pointer inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors ${f?"opacity-50 pointer-events-none":""}`,children:[e.jsx(I,{size:18}),f?"Subiendo...":"Subir Comprobante",e.jsx("input",{type:"file",className:"hidden",accept:"image/*,.pdf",onChange:V,disabled:f})]}),e.jsx("p",{className:"text-xs text-slate-400 mt-2",children:"JPG, PNG, PDF (Max 5MB)"})]}),e.jsx("button",{onClick:()=>j(null),className:"w-full py-2 border border-slate-300 dark:border-slate-600 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700",children:"Cancelar"})]})}),e.jsxs(g,{children:[e.jsxs("h3",{className:"font-bold text-slate-800 dark:text-slate-100 mb-4 flex items-center gap-2",children:[e.jsx(H,{size:18}),"Historial de Pagos"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-200 dark:border-slate-700",children:[e.jsx("th",{className:"text-left py-2 px-3",children:"Fecha"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Concepto"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Monto"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Estado"}),e.jsx("th",{className:"text-right py-2 px-3"})]})}),e.jsx("tbody",{children:((U=t==null?void 0:t.payments)==null?void 0:U.length)>0?t.payments.map(a=>e.jsxs("tr",{className:"border-b border-slate-100 dark:border-slate-700/50",children:[e.jsx("td",{className:"py-2 px-3 text-slate-600 dark:text-slate-400",children:q(a.createdAt)}),e.jsxs("td",{className:"py-2 px-3 font-medium",children:["Plan ",a.plan," (",a.interval==="yearly"?"Anual":a.interval==="quarterly"?"Trimestral":"Mensual",")"]}),e.jsxs("td",{className:"py-2 px-3",children:["$",(a.amount/100).toFixed(2)," USD"]}),e.jsx("td",{className:"py-2 px-3",children:e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${a.status==="VERIFIED"?"bg-green-100 text-green-700":a.status==="REJECTED"?"bg-red-100 text-red-700":"bg-amber-100 text-amber-700"}`,children:a.status==="VERIFIED"?"Completado":a.status==="REJECTED"?"Rechazado":"Pendiente"})}),e.jsx("td",{className:"py-2 px-3 text-right"})]},a.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"text-center py-4 text-slate-500",children:"No hay pagos registrados"})})})]})})]})]})}function C({label:s,used:t,limit:l,unit:x="",icon:m}){const c=l===-1||l===999999||l>1e5,n=c?0:Math.min(100,t/l*100),h=c?"bg-green-500":n>90?"bg-red-500":n>75?"bg-amber-500":"bg-green-500";return e.jsxs(g,{className:"hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-slate-500",children:s}),e.jsx(m,{size:16,className:"text-slate-400"})]}),e.jsxs("div",{className:"flex items-end gap-1 mb-2",children:[e.jsx("span",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100",children:t}),e.jsxs("span",{className:"text-sm text-slate-400 mb-1",children:["/ ",c?"âˆž":l,x]})]}),e.jsx("div",{className:"w-full bg-slate-100 dark:bg-slate-700 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${h} transition-all duration-500`,style:{width:`${n}%`}})})]})}function Z({plan:s,isCurrent:t,onSelect:l}){const x=s.price??(s.monthlyPrice!=null?s.monthlyPrice/100:0),m=x===0||s.id==="FREE";return e.jsxs("div",{className:`relative p-6 rounded-2xl bg-white dark:bg-slate-800 border-2 transition-all ${t?"border-fuchsia-500 shadow-xl scale-105 z-10":"border-slate-100 dark:border-slate-700 hover:border-fuchsia-200 dark:hover:border-slate-600"}`,children:[t&&e.jsx("span",{className:"absolute -top-3 left-1/2 -translate-x-1/2 px-3 py-1 bg-fuchsia-500 text-white text-xs font-bold rounded-full shadow-md",children:"PLAN ACTUAL"}),e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white mb-2",children:s.name}),e.jsxs("div",{className:"mb-4",children:[e.jsx("span",{className:"text-3xl font-extrabold text-slate-900 dark:text-white",children:m?"Gratis":`$${x}`}),!m&&e.jsx("span",{className:"text-slate-500",children:" USD/mes"})]}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-6 min-h-[40px]",children:s.description||"Ideal para comenzar"}),e.jsx("ul",{className:"space-y-3 mb-8",children:(s.features||[]).map((c,n)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm text-slate-600 dark:text-slate-300",children:[e.jsx(L,{size:16,className:"text-green-500 flex-shrink-0"}),e.jsx("span",{children:c})]},n))}),!t&&e.jsx("button",{onClick:()=>l(s),className:`w-full py-2.5 rounded-lg font-bold transition-colors ${s.price>0?"bg-slate-900 dark:bg-white text-white dark:text-slate-900 hover:opacity-90":"border border-slate-300 text-slate-600 hover:bg-slate-50"}`,children:s.price>0?"Seleccionar Plan":"Plan BÃ¡sico"})]})}export{ne as SubscriptionDashboard,P as subscriptionService};
