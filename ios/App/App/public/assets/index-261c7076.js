import{j as e,W as P,f as u,C as M,X as $,b as D}from"./index-d07a4565.js";import{r as i}from"./vendor-8a332d8f.js";import{D as B}from"./download-ccc94549.js";import{T as W}from"./trending-up-aed1c674.js";import{F as H}from"./filter-ac94b5de.js";import{B as K}from"./bar-chart-3-d18468b2.js";import{S as Q}from"./search-001f2433.js";import{C as _}from"./calendar-da7962d8.js";import{P as X}from"./plus-circle-bec9c90c.js";import{U as J}from"./upload-5b885fb0.js";import{R as A}from"./refresh-cw-25914484.js";import{T as U}from"./trash-2-8bdf2c52.js";const y=[{value:"OPERATIVO",label:"Operativo",color:"blue"},{value:"NOMINA",label:"Nómina",color:"violet"},{value:"SERVICIOS",label:"Servicios",color:"amber"},{value:"MARKETING",label:"Marketing",color:"pink"},{value:"TRANSPORTE",label:"Transporte",color:"cyan"},{value:"SUMINISTROS",label:"Suministros",color:"emerald"},{value:"OTRO",label:"Otro",color:"slate"}],Z=x=>{const w=y.find(a=>a.value===x),m=(w==null?void 0:w.color)||"slate";return`bg-${m}-100 dark:bg-${m}-900/30 text-${m}-700 dark:text-${m}-300`};function me({expenses:x,addExpense:w,onDeleteExpense:m}){var L;const[a,c]=i.useState({concept:"",amount:"",category:"OPERATIVO",date:new Date().toISOString().split("T")[0],receiptUrl:"",isRecurring:!1,recurringFrequency:"MONTHLY"}),[h,T]=i.useState(""),[p,R]=i.useState(""),[b,F]=i.useState(""),[j,O]=i.useState("ALL"),[f,C]=i.useState(null),[I,S]=i.useState(!1),N=i.useMemo(()=>{let t=[...x];if(h.trim()){const s=h.toLowerCase();t=t.filter(l=>(l.description||l.concept||"").toLowerCase().includes(s))}return j!=="ALL"&&(t=t.filter(s=>s.category===j)),p&&(t=t.filter(s=>new Date(s.date)>=new Date(p))),b&&(t=t.filter(s=>new Date(s.date)<=new Date(b))),t.sort((s,l)=>new Date(l.date)-new Date(s.date)),t},[x,h,j,p,b]),r=i.useMemo(()=>{const t=new Date,s=x.filter(o=>{const n=new Date(o.date);return n.getMonth()===t.getMonth()&&n.getFullYear()===t.getFullYear()}),l=x.filter(o=>{const n=new Date(o.date),E=new Date(t.getFullYear(),t.getMonth()-1,1);return n.getMonth()===E.getMonth()&&n.getFullYear()===E.getFullYear()}),v=s.reduce((o,n)=>o+parseFloat(n.amount||0),0),g=l.reduce((o,n)=>o+parseFloat(n.amount||0),0),d=N.reduce((o,n)=>o+parseFloat(n.amount||0),0),k={};return s.forEach(o=>{const n=o.category||"OTRO";k[n]=(k[n]||0)+parseFloat(o.amount||0)}),{thisMonthTotal:v,lastMonthTotal:g,filteredTotal:d,byCategory:k,thisMonthCount:s.length}},[x,N]),z=()=>{!a.amount||!a.concept||(w({description:a.concept,amount:parseFloat(a.amount)||0,category:a.category,date:a.date?new Date(a.date).toISOString():new Date().toISOString(),receiptUrl:a.receiptUrl,isRecurring:a.isRecurring,recurringFrequency:a.isRecurring?a.recurringFrequency:null}),c({concept:"",amount:"",category:"OPERATIVO",date:new Date().toISOString().split("T")[0],receiptUrl:"",isRecurring:!1,recurringFrequency:"MONTHLY"}))},Y=t=>{C(t)},q=()=>{f&&m&&m(f.id),C(null)},G=()=>{const t=["Fecha","Concepto","Categoría","Monto","Recurrente"],s=N.map(d=>{var k;return[D(d.date),(d.description||d.concept||"").replace(/,/g,";"),((k=y.find(o=>o.value===d.category))==null?void 0:k.label)||"Otro",d.amount,d.isRecurring?"Sí":"No"].join(",")}),l=[t.join(","),...s].join(`
`),v=new Blob([l],{type:"text/csv;charset=utf-8;"}),g=document.createElement("a");g.href=URL.createObjectURL(v),g.download=`gastos_${new Date().toISOString().split("T")[0]}.csv`,g.click()},V=t=>{var v;const s=(v=t.target.files)==null?void 0:v[0];if(!s)return;S(!0);const l=new FileReader;l.onload=g=>{var d;c({...a,receiptUrl:(d=g.target)==null?void 0:d.result}),S(!1)},l.onerror=()=>{S(!1)},l.readAsDataURL(s)};return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h2",{className:"text-2xl font-bold text-slate-800 dark:text-slate-100 flex items-center gap-2",children:[e.jsx(P,{className:"w-6 h-6 text-emerald-600"}),"Gastos"]}),e.jsxs("button",{onClick:G,className:"bg-emerald-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-emerald-500 transition-colors text-sm font-semibold",children:[e.jsx(B,{size:16}),"Exportar CSV"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-xl bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-100 dark:border-emerald-800",children:[e.jsxs("p",{className:"text-xs text-emerald-600 dark:text-emerald-400 font-semibold flex items-center gap-1",children:[e.jsx(W,{size:12})," Este Mes"]}),e.jsx("p",{className:"text-lg font-bold text-emerald-800 dark:text-emerald-200",children:u(r.thisMonthTotal)}),e.jsxs("p",{className:"text-xs text-emerald-600",children:[r.thisMonthCount," gastos"]})]}),e.jsxs("div",{className:"p-3 rounded-xl bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700",children:[e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400 font-semibold",children:"Mes Anterior"}),e.jsx("p",{className:"text-lg font-bold text-slate-800 dark:text-slate-200",children:u(r.lastMonthTotal)}),e.jsxs("p",{className:"text-xs text-slate-500",children:[r.thisMonthTotal>r.lastMonthTotal?"↑":"↓",Math.abs((r.thisMonthTotal-r.lastMonthTotal)/(r.lastMonthTotal||1)*100).toFixed(0),"%"]})]}),e.jsxs("div",{className:"p-3 rounded-xl bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800",children:[e.jsxs("p",{className:"text-xs text-blue-600 dark:text-blue-400 font-semibold flex items-center gap-1",children:[e.jsx(H,{size:12})," Filtrado"]}),e.jsx("p",{className:"text-lg font-bold text-blue-800 dark:text-blue-200",children:u(r.filteredTotal)}),e.jsxs("p",{className:"text-xs text-blue-600",children:[N.length," resultados"]})]}),e.jsxs("div",{className:"p-3 rounded-xl bg-violet-50 dark:bg-violet-900/20 border border-violet-100 dark:border-violet-800",children:[e.jsxs("p",{className:"text-xs text-violet-600 dark:text-violet-400 font-semibold flex items-center gap-1",children:[e.jsx(K,{size:12})," Top Categoría"]}),Object.keys(r.byCategory).length>0?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm font-bold text-violet-800 dark:text-violet-200",children:(L=y.find(t=>t.value===Object.keys(r.byCategory).sort((s,l)=>r.byCategory[l]-r.byCategory[s])[0]))==null?void 0:L.label}),e.jsx("p",{className:"text-xs text-violet-600",children:u(Math.max(...Object.values(r.byCategory)))})]}):e.jsx("p",{className:"text-sm text-violet-600",children:"Sin datos"})]})]}),e.jsx(M,{children:e.jsxs("div",{className:"flex flex-wrap gap-3 items-center",children:[e.jsxs("div",{className:"flex-1 min-w-[180px] relative",children:[e.jsx(Q,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Buscar gasto...",value:h,onChange:t=>T(t.target.value),className:"w-full pl-9 p-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900/50 text-slate-800 dark:text-slate-200 text-sm"})]}),e.jsxs("select",{value:j,onChange:t=>O(t.target.value),className:"p-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900/50 text-slate-800 dark:text-slate-200 text-sm",children:[e.jsx("option",{value:"ALL",children:"Todas categorías"}),y.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{size:14,className:"text-slate-400"}),e.jsx("input",{type:"date",value:p,onChange:t=>R(t.target.value),className:"p-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900/50 text-slate-800 dark:text-slate-200 text-sm"}),e.jsx("span",{className:"text-xs text-slate-400",children:"a"}),e.jsx("input",{type:"date",value:b,onChange:t=>F(t.target.value),className:"p-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900/50 text-slate-800 dark:text-slate-200 text-sm"})]}),(h||j!=="ALL"||p||b)&&e.jsx("button",{onClick:()=>{T(""),O("ALL"),R(""),F("")},className:"text-xs text-blue-600 hover:underline",children:"Limpiar"})]})}),e.jsxs(M,{children:[e.jsxs("h3",{className:"font-bold text-lg mb-4 text-slate-800 dark:text-slate-100 flex items-center gap-2",children:[e.jsx(X,{size:18,className:"text-emerald-600"}),"Registrar Gasto"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsx("input",{className:"p-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900/50 text-slate-800 dark:text-slate-200",placeholder:"Concepto",value:a.concept,onChange:t=>c({...a,concept:t.target.value})}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("input",{type:"number",className:"p-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900/50 text-slate-800 dark:text-slate-200",placeholder:"Monto",value:a.amount,onChange:t=>c({...a,amount:t.target.value})}),a.amount&&e.jsx("span",{className:"text-xs text-emerald-600 dark:text-emerald-400",children:u(a.amount)})]}),e.jsx("select",{className:"p-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900/50 text-slate-800 dark:text-slate-200",value:a.category,onChange:t=>c({...a,category:t.target.value}),children:y.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),e.jsx("input",{type:"date",className:"p-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-900/50 text-slate-800 dark:text-slate-200",value:a.date,onChange:t=>c({...a,date:t.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"flex-1 flex items-center gap-2 p-2 border border-dashed border-slate-300 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-800 cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors",children:[e.jsx(J,{size:16,className:"text-slate-400"}),e.jsx("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:I?"Subiendo...":a.receiptUrl?"✓ Comprobante adjunto":"Adjuntar factura/recibo"}),e.jsx("input",{type:"file",accept:"image/*",onChange:V,className:"hidden"})]}),a.receiptUrl&&e.jsx("button",{onClick:()=>c({...a,receiptUrl:""}),className:"p-2 text-rose-500 hover:bg-rose-50 dark:hover:bg-rose-900/20 rounded",children:e.jsx($,{size:16})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:a.isRecurring,onChange:t=>c({...a,isRecurring:t.target.checked}),className:"w-4 h-4 rounded text-emerald-600"}),e.jsx(A,{size:14,className:"text-slate-400"}),e.jsx("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Gasto recurrente"})]}),a.isRecurring&&e.jsxs("select",{value:a.recurringFrequency,onChange:t=>c({...a,recurringFrequency:t.target.value}),className:"p-1 text-xs border border-slate-300 dark:border-slate-600 rounded bg-white dark:bg-slate-900/50 text-slate-700 dark:text-slate-300",children:[e.jsx("option",{value:"WEEKLY",children:"Semanal"}),e.jsx("option",{value:"MONTHLY",children:"Mensual"}),e.jsx("option",{value:"YEARLY",children:"Anual"})]})]})]}),e.jsx("button",{onClick:z,className:"mt-4 w-full bg-gradient-to-r from-emerald-600 to-teal-600 text-white px-4 py-3 rounded-lg font-bold hover:shadow-lg transition-all",children:"Guardar Gasto"})]}),e.jsx(M,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-800 text-slate-600 dark:text-slate-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-left",children:"Concepto"}),e.jsx("th",{className:"p-2 text-left",children:"Categoría"}),e.jsx("th",{className:"p-2 text-left",children:"Monto"}),e.jsx("th",{className:"p-2 text-left",children:"Fecha"}),e.jsx("th",{className:"p-2 text-left hidden md:table-cell",children:"Recurrente"}),e.jsx("th",{className:"p-2 text-left hidden lg:table-cell",children:"Comprobante"}),e.jsx("th",{className:"p-2 text-center w-16",children:"Acción"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:[N.map(t=>{var s;return e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-800/50",children:[e.jsx("td",{className:"p-2 text-slate-800 dark:text-slate-200",children:t.description||t.concept||"Gasto"}),e.jsx("td",{className:"p-2",children:e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full font-medium ${Z(t.category)}`,children:((s=y.find(l=>l.value===t.category))==null?void 0:s.label)||"Otro"})}),e.jsx("td",{className:"p-2 text-slate-600 dark:text-slate-400 font-mono",children:u(t.amount)}),e.jsx("td",{className:"p-2 text-slate-600 dark:text-slate-400",children:D(t.date)}),e.jsx("td",{className:"p-2 text-slate-500 dark:text-slate-500 hidden md:table-cell",children:t.isRecurring&&e.jsxs("span",{className:"flex items-center gap-1 text-xs text-violet-600 dark:text-violet-400",children:[e.jsx(A,{size:12}),t.recurringFrequency==="WEEKLY"?"Semanal":t.recurringFrequency==="YEARLY"?"Anual":"Mensual"]})}),e.jsx("td",{className:"p-2 hidden lg:table-cell",children:t.receiptUrl&&e.jsx("a",{href:t.receiptUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline text-xs",children:"Ver"})}),e.jsx("td",{className:"p-2 text-center",children:e.jsx("button",{onClick:()=>Y(t),className:"p-1.5 text-rose-500 hover:bg-rose-50 dark:hover:bg-rose-900/20 rounded transition-colors",title:"Eliminar",children:e.jsx(U,{size:14})})})]},t.id)}),N.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"p-4 text-center text-slate-400 dark:text-slate-500",colSpan:7,children:h||j!=="ALL"||p||b?"No se encontraron gastos con los filtros aplicados.":"No hay gastos registrados."})})]})]})})}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-2xl p-6 w-full max-w-sm animate-fade-in",children:[e.jsxs("h3",{className:"text-lg font-bold text-rose-600 dark:text-rose-400 mb-3 flex items-center gap-2",children:[e.jsx(U,{size:20})," Eliminar Gasto"]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-2",children:"¿Estás seguro de eliminar este gasto?"}),e.jsxs("div",{className:"bg-slate-100 dark:bg-slate-700 rounded-lg p-3 mb-4",children:[e.jsx("p",{className:"font-semibold text-slate-800 dark:text-slate-200",children:f.description||f.concept}),e.jsx("p",{className:"text-emerald-600 dark:text-emerald-400 font-bold",children:u(f.amount)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>C(null),className:"flex-1 py-2.5 rounded-lg font-semibold bg-slate-200 dark:bg-slate-600 text-slate-700 dark:text-slate-200 hover:bg-slate-300",children:"Cancelar"}),e.jsx("button",{onClick:q,className:"flex-1 py-2.5 rounded-lg font-semibold bg-rose-600 text-white hover:bg-rose-500",children:"Sí, eliminar"})]})]})})]})}export{me as ExpensesView};
