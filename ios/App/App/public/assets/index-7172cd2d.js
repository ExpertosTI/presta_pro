import{c as R,i as D,j as e,U as T,r as ne,M as me,_ as Pe,C as B,a as ee,k as ue,t as ge,d as Se,f as W,b as re,L as Ae,X as Ee}from"./index-d07a4565.js";import{r as n}from"./vendor-8a332d8f.js";import{C as ze}from"./ConfirmDialog-28f4d78f.js";import{P as Le}from"./plus-968e5801.js";import{S as $e}from"./search-001f2433.js";import{F as De}from"./filter-ac94b5de.js";import{P as te}from"./phone-69323ed2.js";import{D as se}from"./dollar-sign-e74c04f1.js";import{X as Ie}from"./x-circle-177d4c0c.js";import{T as Re}from"./trash-2-8bdf2c52.js";import{B as Oe}from"./Badge-2d4e4979.js";import{N as Me,D as Ue}from"./DigitalReceipt-c3acdccc.js";import{S as Fe,P as Ve}from"./PaymentConfirmationModal-888311d5.js";import{C as le}from"./clock-0f83d6c6.js";import{A as xe}from"./alert-triangle-f3e24c64.js";import{A as Be}from"./alert-circle-3c072fc1.js";import{B as _e}from"./building-2-134235b3.js";import{E as ie}from"./eye-bb721541.js";import"./html2canvas.esm-e0a7d97b.js";import"./printUtils-04a0a819.js";import"./printer-82ab4f0e.js";const be=R("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]),Ge=R("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),oe=R("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),K=R("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]),He=R("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]),qe=R("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),Je=R("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]),pe=R("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),We=async()=>await D.get("/collectors"),Ke=async t=>await D.post("/collectors",t),Xe=async(t,c)=>await D.put(`/collectors/${t}`,c),Qe=async(t,c)=>await D.put(`/collectors/${t}/permissions`,{permissions:c}),Ye=async t=>await D.post(`/collectors/${t}/reset-password`),Ze=async t=>await D.delete(`/collectors/${t}`),Te=async(t,c=1,i=50)=>await D.get(`/collectors/${t}/activity`,{params:{page:c,limit:i}}),et=async(t,c)=>await D.post(`/collectors/${t}/assign-clients`,{clientIds:c}),tt=async(t,c=[])=>await D.post(`/collectors/${t}/unassign-clients`,{clientIds:c}),I={getCollectors:We,createCollector:Ke,updateCollector:Xe,updatePermissions:Qe,resetPassword:Ye,deleteCollector:Ze,getActivity:Te,assignClients:et,unassignClients:tt},st={canViewAllClients:!1,canRegisterPayments:!0,canApplyPenalties:!0,canViewLoanDetails:!0,canViewClientDocuments:!1,canEditClients:!1,canViewReports:!1,maxPaymentAmount:null},at={canViewAllClients:{label:"Ver todos los clientes",desc:"Ver clientes no asignados"},canRegisterPayments:{label:"Registrar pagos",desc:"Cobrar cuotas"},canApplyPenalties:{label:"Aplicar mora",desc:"Agregar penalidades"},canViewLoanDetails:{label:"Ver prÃ©stamos",desc:"Detalles de prÃ©stamos"},canViewClientDocuments:{label:"Ver documentos",desc:"Documentos de clientes"},canEditClients:{label:"Editar clientes",desc:"Modificar datos"},canViewReports:{label:"Ver reportes",desc:"Acceso a reportes"}};function zt({showToast:t,clients:c=[],receipts:i=[]}){const[r,o]=n.useState([]),[g,x]=n.useState(!0),[N,u]=n.useState(!1),[y,p]=n.useState(null),[v,h]=n.useState(null),[P,z]=n.useState(null),[O,M]=n.useState([]),[S,k]=n.useState(null),[C,A]=n.useState("ALL"),[L,_]=n.useState(""),[E,U]=n.useState({open:!1,title:"",message:"",onConfirm:null}),[X,H]=n.useState(!1),[F,q]=n.useState(null),[a,m]=n.useState([]),[d,f]=n.useState({name:"",phone:"",email:"",photoUrl:"",createCredentials:!1,username:"",commissionRate:5,lastLatitude:null,lastLongitude:null});n.useEffect(()=>{w()},[]);const w=async()=>{try{x(!0);const s=await I.getCollectors();o(s)}catch{t==null||t("Error cargando cobradores","error")}finally{x(!1)}},G=async s=>{s.preventDefault();try{if(y){const l=await I.updateCollector(y.id,d);o(b=>b.map(j=>j.id===y.id?{...j,...l}:j)),t==null||t("Cobrador actualizado","success")}else{const l=await I.createCollector(d);o(b=>[l,...b]),l.temporaryPassword&&k(l.temporaryPassword),t==null||t("Cobrador creado","success")}de()}catch(l){t==null||t(l.message||"Error guardando cobrador","error")}},Q=async s=>{U({open:!0,title:"Eliminar cobrador",message:"Â¿Eliminar este cobrador? Los clientes asignados serÃ¡n desasignados.",onConfirm:async()=>{try{await I.deleteCollector(s),o(l=>l.filter(b=>b.id!==s)),t==null||t("Cobrador eliminado","success")}catch{t==null||t("Error eliminando cobrador","error")}}})},ae=async s=>{U({open:!0,title:"Resetear contraseÃ±a",message:"Â¿Generar nueva contraseÃ±a? La anterior dejarÃ¡ de funcionar.",onConfirm:async()=>{try{const l=await I.resetPassword(s);k(l.newPassword),t==null||t(l.message||"ContraseÃ±a reseteada","success")}catch{t==null||t("Error reseteando contraseÃ±a","error")}}})},he=async(s,l)=>{try{await I.updatePermissions(s,l),o(b=>b.map(j=>j.id===s?{...j,permissions:l}:j)),h(null),t==null||t("Permisos actualizados","success")}catch{t==null||t("Error guardando permisos","error")}},fe=async s=>{z(s);try{const l=await I.getActivity(s.id);M(l.activities||[])}catch{M([])}},de=()=>{u(!1),p(null),f({name:"",phone:"",email:"",photoUrl:"",createCredentials:!1,username:"",commissionRate:5,lastLatitude:null,lastLongitude:null})},je=s=>{p(s),f({name:s.name,phone:s.phone||"",email:s.email||"",photoUrl:s.photoUrl||"",createCredentials:!1,username:s.username||"",commissionRate:s.commissionRate||5,lastLatitude:s.lastLatitude||null,lastLongitude:s.lastLongitude||null}),u(!0)},Ne=s=>{navigator.clipboard.writeText(s),t==null||t("Copiado al portapapeles","success")},ye=s=>{var b;q(s);const l=((b=s.clients)==null?void 0:b.map(j=>j.id))||[];m(l),H(!0)},ve=async()=>{if(F)try{await I.assignClients(F.id,a),t==null||t(`Clientes asignados a ${F.name}`,"success"),H(!1),q(null),w()}catch{t==null||t("Error asignando clientes","error")}},ke=s=>{m(l=>l.includes(s)?l.filter(b=>b!==s):[...l,s])},ce=n.useMemo(()=>{let s=r;if(C==="ACTIVE"?s=s.filter(l=>l.isActive!==!1):C==="INACTIVE"&&(s=s.filter(l=>l.isActive===!1)),L.trim()){const l=L.toLowerCase();s=s.filter(b=>{var j,J,V;return((j=b.name)==null?void 0:j.toLowerCase().includes(l))||((J=b.phone)==null?void 0:J.toLowerCase().includes(l))||((V=b.email)==null?void 0:V.toLowerCase().includes(l))})}return s},[r,C,L]),Ce=n.useMemo(()=>{const s={};return r.forEach(l=>{const j=c.filter($=>$.collectorId===l.id).map($=>$.id),V=i.filter($=>j.includes($.clientId)).reduce(($,we)=>$+parseFloat(we.amount||0),0),Y=l.commissionRate||5;s[l.id]={totalCollected:V,rate:Y,commission:V*Y/100}}),s},[r,c,i]);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-indigo-100 dark:bg-indigo-900/30 rounded-xl",children:e.jsx(T,{className:"w-6 h-6 text-indigo-600 dark:text-indigo-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:"Cobradores"}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:[r.length," cobradores registrados"]})]})]}),e.jsxs("button",{onClick:()=>u(!0),className:"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[e.jsx(Le,{size:18}),"Nuevo Cobrador"]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx($e,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Buscar por nombre, telÃ©fono...",value:L,onChange:s=>_(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-sm"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{size:16,className:"text-slate-400"}),e.jsxs("select",{value:C,onChange:s=>A(s.target.value),className:"px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-sm",children:[e.jsx("option",{value:"ALL",children:"Todos"}),e.jsx("option",{value:"ACTIVE",children:"Activos"}),e.jsx("option",{value:"INACTIVE",children:"Inactivos"})]})]}),e.jsxs("p",{className:"text-sm text-slate-500",children:["Mostrando ",ce.length," de ",r.length]})]}),e.jsx(ze,{isOpen:E.open,onClose:()=>U(s=>({...s,open:!1})),onConfirm:E.onConfirm,title:E.title,message:E.message,confirmText:"Eliminar",variant:"danger"}),S&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-6 max-w-md w-full",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-800 dark:text-slate-100 mb-4 flex items-center gap-2",children:[e.jsx(K,{className:"text-amber-500"}),"ContraseÃ±a Temporal"]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400 mb-4",children:"Guarda esta contraseÃ±a. El cobrador deberÃ¡ cambiarla en su primer inicio de sesiÃ³n."}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-slate-100 dark:bg-slate-700 rounded-lg mb-4",children:[e.jsx("code",{className:"flex-1 text-lg font-mono text-slate-800 dark:text-slate-200",children:S}),e.jsx("button",{onClick:()=>Ne(S),className:"p-2 hover:bg-slate-200 dark:hover:bg-slate-600 rounded",children:e.jsx(Ge,{size:18})})]}),e.jsx("button",{onClick:()=>k(null),className:"w-full py-2 bg-indigo-600 text-white rounded-lg font-medium",children:"Entendido"})]})}),N&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-slate-100 mb-4",children:y?"Editar Cobrador":"Nuevo Cobrador"}),e.jsxs("form",{onSubmit:G,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:[e.jsx(ne,{size:14,className:"inline mr-1"}),"Nombre *"]}),e.jsx("input",{type:"text",required:!0,value:d.name,onChange:s=>f(l=>({...l,name:s.target.value})),className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800",placeholder:"Juan PÃ©rez"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:[e.jsx(te,{size:14,className:"inline mr-1"}),"TelÃ©fono"]}),e.jsx("input",{type:"tel",value:d.phone,onChange:s=>f(l=>({...l,phone:s.target.value})),className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800",placeholder:"809-555-1234"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:[e.jsx(me,{size:14,className:"inline mr-1"}),"Email"]}),e.jsx("input",{type:"email",value:d.email,onChange:s=>f(l=>({...l,email:s.target.value})),className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800",placeholder:"cobrador@email.com"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"ðŸ“· Foto del Cobrador"}),e.jsxs("div",{className:"flex items-center gap-3",children:[d.photoUrl&&e.jsx("img",{src:d.photoUrl,alt:"Preview",className:"w-16 h-16 rounded-full object-cover border-2 border-indigo-500"}),e.jsxs("label",{className:"flex-1 cursor-pointer",children:[e.jsx("div",{className:"flex items-center justify-center gap-2 px-4 py-2 border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-lg hover:border-indigo-500 transition-colors",children:e.jsx("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:d.photoUrl?"Cambiar foto":"Subir foto o tomar con cÃ¡mara"})}),e.jsx("input",{type:"file",accept:"image/*",capture:"environment",className:"hidden",onChange:async s=>{var b;const l=(b=s.target.files)==null?void 0:b[0];if(l)try{const{fileToBase64:j,resizeImage:J}=await Pe(()=>import("./imageUtils-542d258e.js"),[],import.meta.url),V=await j(l),Y=await J(V,300,300);f($=>({...$,photoUrl:Y}))}catch(j){console.error("Error processing photo:",j)}}})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:[e.jsx(se,{size:14,className:"inline mr-1"}),"Tasa de ComisiÃ³n (%)"]}),e.jsx("input",{type:"number",step:"0.5",min:"0",max:"100",value:d.commissionRate,onChange:s=>f(l=>({...l,commissionRate:parseFloat(s.target.value)||0})),className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800",placeholder:"5"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Porcentaje sobre cobros realizados"})]}),!y&&e.jsxs("div",{className:"p-4 bg-indigo-50 dark:bg-indigo-900/20 rounded-lg",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:d.createCredentials,onChange:s=>f(l=>({...l,createCredentials:s.target.checked})),className:"w-5 h-5 rounded text-indigo-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-800 dark:text-slate-200",children:"Crear credenciales de acceso"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Permitir login al cobrador"})]})]}),d.createCredentials&&e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Usuario"}),e.jsx("input",{type:"text",value:d.username,onChange:s=>f(l=>({...l,username:s.target.value.toLowerCase().replace(/\s/g,".")})),className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800",placeholder:d.name.toLowerCase().replace(/\s/g,".")||"usuario"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Se generarÃ¡ una contraseÃ±a temporal"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:de,className:"flex-1 py-2 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-600 dark:text-slate-400 font-medium",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"flex-1 py-2 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700",children:y?"Guardar":"Crear"})]})]})]})}),v&&e.jsx(rt,{collector:v,onSave:s=>he(v.id,s),onClose:()=>h(null)}),P&&e.jsx(lt,{collector:P,activities:O,onClose:()=>z(null)}),g?e.jsx(B,{children:e.jsx("p",{className:"text-center text-slate-500 py-8",children:"Cargando cobradores..."})}):r.length===0?e.jsx(B,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(T,{className:"w-12 h-12 text-slate-300 dark:text-slate-600 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"No hay cobradores registrados"}),e.jsx("button",{onClick:()=>u(!0),className:"mt-4 px-4 py-2 bg-indigo-600 text-white rounded-lg",children:"Crear primer cobrador"})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:ce.map(s=>{var b,j;const l=Ce[s.id]||{totalCollected:0,rate:5,commission:0};return e.jsxs(B,{className:"relative",children:[e.jsx("div",{className:"absolute top-4 right-4",children:s.isActive!==!1?e.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 rounded-full text-xs font-medium",children:[e.jsx(ee,{size:12}),"Activo"]}):e.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400 rounded-full text-xs font-medium",children:[e.jsx(Ie,{size:12}),"Inactivo"]})}),e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[s.photoUrl?e.jsx("img",{src:s.photoUrl,alt:s.name,className:"w-12 h-12 rounded-full object-cover border-2 border-indigo-300"}):e.jsx("div",{className:"w-12 h-12 bg-indigo-100 dark:bg-indigo-900/30 rounded-full flex items-center justify-center text-xl font-bold text-indigo-600 dark:text-indigo-400",children:s.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-slate-800 dark:text-slate-100 truncate",children:s.name}),s.phone&&e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 flex items-center gap-1",children:[e.jsx(te,{size:12}),s.phone]}),s.email&&e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 flex items-center gap-1 truncate",children:[e.jsx(me,{size:12}),s.email]})]})]}),e.jsxs("div",{className:"flex gap-4 mb-4 text-sm",children:[e.jsxs("div",{className:"flex-1 text-center p-2 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[e.jsx("p",{className:"font-bold text-slate-800 dark:text-slate-200",children:((b=s.clients)==null?void 0:b.length)||0}),e.jsx("p",{className:"text-xs text-slate-500",children:"Clientes"})]}),e.jsxs("div",{className:"flex-1 text-center p-2 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[e.jsx("p",{className:"font-bold text-slate-800 dark:text-slate-200",children:((j=s._count)==null?void 0:j.routeClosings)||0}),e.jsx("p",{className:"text-xs text-slate-500",children:"Cierres"})]})]}),s.hasCredentials&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-blue-50 dark:bg-blue-900/20 rounded-lg mb-4",children:[e.jsx(K,{size:14,className:"text-blue-600 dark:text-blue-400"}),e.jsxs("span",{className:"text-sm text-blue-700 dark:text-blue-300",children:["Usuario: ",s.username]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-emerald-50 dark:bg-emerald-900/20 rounded-lg mb-3",children:[e.jsx(se,{size:14,className:"text-emerald-600"}),e.jsxs("div",{className:"flex-1 text-xs",children:[e.jsxs("p",{className:"text-emerald-700 dark:text-emerald-300",children:["Cobrado: ",e.jsxs("span",{className:"font-bold",children:["$",l.totalCollected.toLocaleString()]})]}),e.jsxs("p",{className:"text-emerald-600",children:["ComisiÃ³n (",l.rate,"%): ",e.jsxs("span",{className:"font-bold",children:["$",l.commission.toLocaleString()]})]})]})]}),s.lastLatitude&&s.lastLongitude&&e.jsxs("a",{href:`https://www.google.com/maps?q=${s.lastLatitude},${s.lastLongitude}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-3 py-2 bg-blue-50 dark:bg-blue-900/20 rounded-lg mb-3 hover:bg-blue-100",children:[e.jsx(ue,{size:14,className:"text-blue-600"}),e.jsx("span",{className:"text-xs text-blue-700 dark:text-blue-300",children:"Ver Ãºltima ubicaciÃ³n"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:()=>je(s),className:"flex-1 flex items-center justify-center gap-1 py-2 text-sm border border-slate-300 dark:border-slate-600 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:[e.jsx(Je,{size:14}),"Editar"]}),e.jsxs("button",{onClick:()=>h(s),className:"flex-1 flex items-center justify-center gap-1 py-2 text-sm border border-slate-300 dark:border-slate-600 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:[e.jsx(ge,{size:14}),"Permisos"]}),e.jsx("button",{onClick:()=>ye(s),className:"flex items-center justify-center gap-1 py-2 px-3 text-sm bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",title:"Asignar Clientes",children:e.jsx(pe,{size:14})}),e.jsx("button",{onClick:()=>fe(s),className:"flex items-center justify-center gap-1 py-2 px-3 text-sm border border-slate-300 dark:border-slate-600 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:e.jsx(be,{size:14})}),s.hasCredentials&&e.jsx("button",{onClick:()=>ae(s.id),className:"flex items-center justify-center gap-1 py-2 px-3 text-sm border border-slate-300 dark:border-slate-600 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700",children:e.jsx(K,{size:14})}),e.jsx("button",{onClick:()=>Q(s.id),className:"flex items-center justify-center gap-1 py-2 px-3 text-sm text-red-600 border border-red-300 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20",children:e.jsx(Re,{size:14})})]})]},s.id)})}),X&&F&&e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-6 max-w-md w-full max-h-[80vh] overflow-hidden flex flex-col",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-800 dark:text-slate-100 mb-2 flex items-center gap-2",children:[e.jsx(pe,{className:"text-indigo-600",size:20}),"Asignar Clientes a ",F.name]}),e.jsx("p",{className:"text-xs text-slate-500 mb-4",children:"Selecciona los clientes que este cobrador gestionarÃ¡"}),e.jsx("div",{className:"flex-1 overflow-y-auto space-y-2 mb-4 pr-2",children:c.length===0?e.jsx("p",{className:"text-center text-slate-400 py-4",children:"No hay clientes disponibles"}):c.map(s=>e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-colors ${a.includes(s.id)?"bg-indigo-50 dark:bg-indigo-900/30 border-2 border-indigo-500":"bg-slate-50 dark:bg-slate-700 border-2 border-transparent hover:border-slate-300"}`,children:[e.jsx("input",{type:"checkbox",checked:a.includes(s.id),onChange:()=>ke(s.id),className:"w-5 h-5 rounded text-indigo-600"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-slate-800 dark:text-slate-200 truncate",children:s.name}),e.jsx("p",{className:"text-xs text-slate-500",children:s.phone||"-"})]})]},s.id))}),e.jsxs("div",{className:"flex gap-2 pt-4 border-t border-slate-200 dark:border-slate-700",children:[e.jsx("button",{onClick:()=>{H(!1),q(null)},className:`flex-1 py-2\r
                                 px-4 border border-slate-300 dark:border-slate-600 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700`,children:"Cancelar"}),e.jsxs("button",{onClick:ve,className:"flex-1 py-2 px-4 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-bold",children:["Guardar (",a.length,")"]})]})]})})]})}function rt({collector:t,onSave:c,onClose:i}){const[r,o]=n.useState(t.permissions||st),g=x=>{o(N=>({...N,[x]:!N[x]}))};return e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-6 max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-800 dark:text-slate-100 mb-4 flex items-center gap-2",children:[e.jsx(ge,{className:"text-indigo-600"}),"Permisos de ",t.name]}),e.jsx("div",{className:"space-y-3 mb-6",children:Object.entries(at).map(([x,{label:N,desc:u}])=>e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-700",children:[e.jsx("input",{type:"checkbox",checked:r[x]||!1,onChange:()=>g(x),className:"w-5 h-5 rounded text-indigo-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-slate-800 dark:text-slate-200",children:N}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:u})]})]},x))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:i,className:"flex-1 py-2 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-600 dark:text-slate-400 font-medium",children:"Cancelar"}),e.jsx("button",{onClick:()=>c(r),className:"flex-1 py-2 bg-indigo-600 text-white rounded-lg font-medium",children:"Guardar Permisos"})]})]})})}function lt({collector:t,activities:c,onClose:i}){const r={LOGIN:{label:"Inicio de sesiÃ³n",icon:"ðŸ”“",color:"text-green-600"},LOGOUT:{label:"Cierre de sesiÃ³n",icon:"ðŸ”’",color:"text-slate-500"},PAYMENT_REGISTERED:{label:"Pago registrado",icon:"ðŸ’°",color:"text-emerald-600"},CLIENT_VISITED:{label:"Cliente visitado",icon:"ðŸ‘¤",color:"text-blue-600"},ROUTE_STARTED:{label:"Ruta iniciada",icon:"ðŸš€",color:"text-indigo-600"},ROUTE_FINISHED:{label:"Ruta finalizada",icon:"âœ…",color:"text-teal-600"}};return e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-6 max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-800 dark:text-slate-100 mb-4 flex items-center gap-2",children:[e.jsx(be,{className:"text-indigo-600"}),"Actividad de ",t.name]}),c.length===0?e.jsx("p",{className:"text-center text-slate-500 py-8",children:"Sin actividad registrada"}):e.jsx("div",{className:"space-y-3 mb-4",children:c.map(o=>{const g=r[o.action]||{label:o.action,icon:"ðŸ“Œ",color:"text-slate-600"};return e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg",children:[e.jsx("span",{className:"text-lg",children:g.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:`font-medium ${g.color}`,children:g.label}),e.jsx("p",{className:"text-xs text-slate-500",children:Se(o.createdAt)}),o.details&&e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:JSON.stringify(o.details)})]})]},o.id)})}),e.jsx("button",{onClick:i,className:"w-full py-2 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-600 dark:text-slate-400 font-medium",children:"Cerrar"})]})})}const nt="58mm",Z="54mm";function it(t,c={}){const{companyName:i="Presta Pro",companyLogo:r=null,isCopy:o=!1}=c,g=p=>new Intl.NumberFormat("es-DO",{style:"currency",currency:"DOP"}).format(p||0),x=p=>new Date(p).toLocaleDateString("es-DO",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),N=parseFloat(t.amount||0),u=parseFloat(t.penaltyAmount||0),y=N+u;return`
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Comprobante de Pago${o?" (COPIA)":""}</title>
    <style>
        @page {
            size: ${nt} auto;
            margin: 2mm;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Courier New', monospace;
            font-size: 11px;
            line-height: 1.3;
            width: ${Z};
            max-width: ${Z};
            color: #000;
            background: #fff;
            padding: 2mm;
        }
        
        .header {
            text-align: center;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px dashed #000;
        }
        
        .logo {
            max-width: 40mm;
            max-height: 15mm;
            margin-bottom: 4px;
        }
        
        .company-name {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 2px;
        }
        
        .receipt-title {
            font-size: 12px;
            font-weight: bold;
            margin: 4px 0;
        }
        
        .receipt-id {
            font-size: 10px;
            color: #666;
        }
        
        .date {
            font-size: 10px;
            margin-top: 4px;
        }
        
        .divider {
            border-top: 1px dashed #000;
            margin: 6px 0;
        }
        
        .section {
            margin: 6px 0;
        }
        
        .section-title {
            font-weight: bold;
            font-size: 10px;
            margin-bottom: 2px;
        }
        
        .row {
            display: flex;
            justify-content: space-between;
            margin: 2px 0;
        }
        
        .label {
            color: #333;
        }
        
        .value {
            font-weight: bold;
            text-align: right;
        }
        
        .total-section {
            text-align: center;
            padding: 8px 0;
            margin: 8px 0;
            border-top: 2px solid #000;
            border-bottom: 2px solid #000;
        }
        
        .total-label {
            font-size: 11px;
            color: #333;
        }
        
        .total-amount {
            font-size: 18px;
            font-weight: bold;
            margin: 4px 0;
        }
        
        .payment-type {
            font-size: 10px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .penalty {
            color: #c00;
        }
        
        .footer {
            text-align: center;
            margin-top: 10px;
            padding-top: 6px;
            border-top: 1px dashed #000;
            font-size: 9px;
        }
        
        .footer-thanks {
            font-weight: bold;
            margin-bottom: 2px;
        }
        
        @media print {
            body {
                width: ${Z} !important;
                max-width: ${Z} !important;
            }
        }
    </style>
</head>
<body>
    ${o?'<div style="text-align:center;font-weight:bold;border:2px solid #000;padding:4px;margin-bottom:6px;font-size:14px;">*** COPIA ***</div>':""}
    <div class="header">
        ${r?`<img src="${r}" class="logo" alt="${i}">`:""}
        <div class="company-name">${i}</div>
        <div class="receipt-title">COMPROBANTE DE PAGO${o?" (REIMPRESO)":""}</div>
        <div class="receipt-id">Ref: TPPR3N4${(t.id||"").slice(-6).toUpperCase().padStart(6,"0")}</div>
        <div class="date">${x(t.date||new Date)}</div>
    </div>
    
    <div class="section">
        <div class="section-title">CLIENTE</div>
        <div>${t.clientName||"Cliente"}</div>
        ${t.clientPhone?`<div>${t.clientPhone}</div>`:""}
    </div>
    
    ${t.loanAmount?`
    <div class="section">
        <div class="section-title">PRÃ‰STAMO</div>
        <div class="row">
            <span class="label">Capital</span>
            <span class="value">${g(t.loanAmount)}</span>
        </div>
        ${t.installmentNumber?`
        <div class="row">
            <span class="label">Cuota(s) Pagada(s)</span>
            <span class="value">#${t.installmentNumber}</span>
        </div>
        `:""}
        ${t.remainingBalance!==void 0?`
        <div class="row" style="border-top: 1px solid #ccc; padding-top: 3px; margin-top: 3px;">
            <span class="label"><strong>Saldo Restante</strong></span>
            <span class="value"><strong>${g(t.remainingBalance)}</strong></span>
        </div>
        `:""}
    </div>
    `:""}
    
    <div class="divider"></div>
    
    <div class="section">
        <div class="section-title">DETALLE</div>
        ${t.paymentBreakdown&&t.paymentBreakdown.length>0?t.paymentBreakdown.map(p=>`
                <div class="row">
                    <span class="label">Cuota #${p.number}</span>
                    <span class="value">${g(p.amount)}</span>
                </div>
            `).join(""):`
                <div class="row">
                    <span class="label">Cuota #${t.installmentNumber||"1"}</span>
                    <span class="value">${g(N)}</span>
                </div>
            `}
        ${u>0?`
        <div class="row penalty">
            <span class="label">Mora</span>
            <span class="value">${g(u)}</span>
        </div>
        `:""}
        ${t.remainingBalance!==void 0&&t.remainingBalance>0?`
        <div class="row">
            <span class="label">Saldo Pendiente</span>
            <span class="value">${g(t.remainingBalance)}</span>
        </div>
        `:""}
    </div>
    
    <div class="total-section">
        <div class="total-label">TOTAL PAGADO</div>
        <div class="total-amount">${g(y)}</div>
        <div class="payment-type">PAGO DE PRÃ‰STAMO</div>
    </div>
    
    <div class="footer">
        <div class="footer-thanks">Â¡Gracias por su pago!</div>
        <div>Conserve este comprobante</div>
    </div>
</body>
</html>
    `.trim()}function ot(t,c={}){var g;const i=it(t,c),r=document.createElement("iframe");r.style.position="absolute",r.style.width="0",r.style.height="0",r.style.border="none",r.style.visibility="hidden",document.body.appendChild(r);const o=((g=r.contentWindow)==null?void 0:g.document)||r.contentDocument;o&&(o.open(),o.write(i),o.close(),r.onload=()=>{setTimeout(()=>{var x;try{(x=r.contentWindow)==null||x.print()}catch(N){console.error("Print error:",N);const u=window.open("","_blank","width=320,height=600");u&&(u.document.write(i),u.document.close(),u.focus(),u.print())}setTimeout(()=>{document.body.removeChild(r)},1e3)},100)})}function Lt({collector:t,onLogout:c,onChangePassword:i,showToast:r}){const[o,g]=n.useState([]),[x,N]=n.useState([]),[u,y]=n.useState(!0),[p,v]=n.useState(null),[h,P]=n.useState(null),[z,O]=n.useState("cobros"),[M,S]=n.useState(!1),[k,C]=n.useState({category:"",amount:"",description:""}),[A,L]=n.useState([]);n.useEffect(()=>{_()},[t==null?void 0:t.id]);const _=async()=>{if(t!=null&&t.id)try{y(!0);const a=localStorage.getItem("collectorToken"),m=await fetch(`/api/collectors/${t.id}/clients`,{headers:{Authorization:`Bearer ${a}`}});if(m.ok){const d=await m.json();g(d);const f=d.flatMap(w=>(w.loans||[]).map(G=>({...G,clientName:w.name,clientPhone:w.phone,clientAddress:w.address})));N(f)}else{const d=await m.json();r==null||r(d.error||"Error cargando datos","error")}}catch(a){console.error("Error loading collector data:",a),r==null||r("Error cargando datos","error")}finally{y(!1)}},E=n.useMemo(()=>{const a=new Date().toISOString().split("T")[0];return x.flatMap(m=>(Array.isArray(m.installments)?m.installments:[]).filter(f=>{var w;return f.status==="PENDING"&&((w=f.date)==null?void 0:w.split("T")[0])<=a}).map(f=>{var w;return{...f,loanId:m.id,clientName:m.clientName,clientPhone:m.clientPhone,clientAddress:m.clientAddress,isOverdue:((w=f.date)==null?void 0:w.split("T")[0])<a}}))},[x]),U=n.useMemo(()=>{const a=E.reduce((m,d)=>m+(d.payment||0),0);return{totalClients:o.length,pendingCount:E.length,totalPending:a}},[o,E]),X=async()=>{if(!navigator.geolocation)return null;try{const a=await new Promise((m,d)=>{navigator.geolocation.getCurrentPosition(m,d,{timeout:5e3,enableHighAccuracy:!0})});return{latitude:a.coords.latitude,longitude:a.coords.longitude}}catch{return console.log("Location not available"),null}},H=async(a,m,d)=>{try{const f=localStorage.getItem("collectorToken"),w=await X(),G=await fetch("/api/payments",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${f}`},body:JSON.stringify({loanId:a,installmentId:m,amount:d.customAmount,penaltyAmount:d.penaltyAmount||0,collectorId:t.id,location:w})}),Q=await G.json();G.ok?(r==null||r("âœ… Pago registrado correctamente","success"),L(ae=>[...ae,{clientName:p.clientName,clientPhone:p.clientPhone,number:p.number,amount:d.customAmount||p.amount,date:new Date}]),P({...Q.receipt,clientName:p.clientName,clientPhone:p.clientPhone,amount:d.customAmount||p.amount,number:p.number}),v(null),_()):r==null||r(Q.error||"Error registrando pago","error")}catch(f){console.error("Payment error:",f),r==null||r("Error registrando pago","error")}},F=a=>{var d;const m=`ðŸ§¾ *Recibo de Pago*
Cliente: ${a.clientName}
Cuota: #${a.number}
Monto: ${W(a.payment)}
Fecha: ${re(new Date)}
        
_PrestaPro by RENACE.TECH_`;window.open(`https://wa.me/${(d=a.clientPhone)==null?void 0:d.replace(/\D/g,"")}?text=${encodeURIComponent(m)}`)},q=async()=>{try{const a=localStorage.getItem("collectorToken"),m=await X(),d=await fetch("/api/collectors/expenses",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({collectorId:t.id,category:k.category,amount:parseFloat(k.amount),description:k.description,location:m})});if(d.ok)r==null||r("âœ… Gasto registrado","success"),S(!1),C({category:"",amount:"",description:""});else{const f=await d.json();r==null||r(f.error||"Error registrando gasto","error")}}catch(a){console.error("Expense error:",a),r==null||r("Error registrando gasto","error")}};return u?e.jsx("div",{className:"min-h-screen bg-slate-100 dark:bg-slate-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-indigo-500 border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Cargando..."})]})}):e.jsxs("div",{className:"min-h-screen bg-slate-100 dark:bg-slate-900 pb-20",children:[e.jsx("div",{className:"sticky top-0 z-40 bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-4 py-3 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-white/20 rounded-full flex items-center justify-center",children:t!=null&&t.photoUrl?e.jsx("img",{src:t.photoUrl,alt:"",className:"w-full h-full rounded-full object-cover"}):e.jsx(T,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-base font-bold",children:t==null?void 0:t.name}),e.jsx("p",{className:"text-xs text-white/70",children:"Cobrador"})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:i,className:"p-2 hover:bg-white/10 rounded-full",title:"Cambiar contraseÃ±a",children:e.jsx(K,{size:18})}),e.jsx("button",{onClick:c,className:"p-2 hover:bg-white/10 rounded-full",title:"Salir",children:e.jsx(qe,{size:18})})]})]})}),e.jsxs("div",{className:"flex gap-3 px-4 py-4 overflow-x-auto",children:[e.jsxs("div",{className:"flex-shrink-0 bg-white dark:bg-slate-800 rounded-xl p-4 min-w-[100px] text-center shadow",children:[e.jsx(T,{className:"w-5 h-5 text-blue-500 mx-auto mb-1"}),e.jsx("p",{className:"text-xl font-bold text-slate-900 dark:text-white",children:U.totalClients}),e.jsx("p",{className:"text-[10px] text-slate-500",children:"Clientes"})]}),e.jsxs("div",{className:"flex-shrink-0 bg-white dark:bg-slate-800 rounded-xl p-4 min-w-[100px] text-center shadow",children:[e.jsx(le,{className:"w-5 h-5 text-orange-500 mx-auto mb-1"}),e.jsx("p",{className:"text-xl font-bold text-slate-900 dark:text-white",children:U.pendingCount}),e.jsx("p",{className:"text-[10px] text-slate-500",children:"Pendientes"})]}),e.jsxs("div",{className:"flex-shrink-0 bg-white dark:bg-slate-800 rounded-xl p-4 min-w-[120px] text-center shadow",children:[e.jsx(se,{className:"w-5 h-5 text-green-500 mx-auto mb-1"}),e.jsx("p",{className:"text-lg font-bold text-slate-900 dark:text-white",children:W(U.totalPending)}),e.jsx("p",{className:"text-[10px] text-slate-500",children:"Por Cobrar"})]}),e.jsxs("div",{className:"flex-shrink-0 bg-white dark:bg-slate-800 rounded-xl p-4 min-w-[100px] text-center shadow",children:[e.jsx(ee,{className:"w-5 h-5 text-emerald-500 mx-auto mb-1"}),e.jsx("p",{className:"text-xl font-bold text-slate-900 dark:text-white",children:A.length}),e.jsx("p",{className:"text-[10px] text-slate-500",children:"Cobrados"})]})]}),z==="cobros"?e.jsxs("div",{className:"px-4",children:[e.jsxs("h2",{className:"text-sm font-bold text-slate-700 dark:text-slate-300 mb-3 flex items-center gap-2",children:["ðŸ“‹ Cobros Pendientes",e.jsx("span",{className:"bg-orange-100 text-orange-600 text-xs px-2 py-0.5 rounded-full",children:E.length})]}),E.length===0?e.jsxs(B,{className:"p-8 text-center",children:[e.jsx(ee,{className:"w-12 h-12 text-green-500 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Â¡No hay cobros pendientes!"})]}):e.jsx("div",{className:"space-y-3",children:E.map((a,m)=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-4 shadow-sm border-l-4 border-indigo-500",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-slate-900 dark:text-white truncate",children:a.clientName}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500 mt-1",children:[e.jsx(te,{size:12}),e.jsx("a",{href:`tel:${a.clientPhone}`,className:"text-blue-600",children:a.clientPhone})]}),a.clientAddress&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500 mt-1",children:[e.jsx(ue,{size:12}),e.jsx("span",{className:"truncate",children:a.clientAddress})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs(Oe,{variant:a.isOverdue?"danger":"warning",children:["Cuota #",a.number]}),a.isOverdue&&e.jsxs("p",{className:"text-[10px] text-red-500 mt-1 flex items-center gap-1 justify-end",children:[e.jsx(xe,{size:10})," Vencida"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-indigo-600 dark:text-indigo-400",children:W(a.payment)}),e.jsxs("p",{className:"text-[10px] text-slate-500",children:["Vence: ",re(a.date)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("a",{href:`tel:${a.clientPhone}`,className:"w-10 h-10 flex items-center justify-center bg-blue-100 text-blue-600 rounded-full",children:e.jsx(te,{size:18})}),a.clientAddress&&e.jsx("button",{onClick:()=>window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(a.clientAddress)}`),className:"w-10 h-10 flex items-center justify-center bg-purple-100 text-purple-600 rounded-full",children:e.jsx(Me,{size:18})}),e.jsx("button",{onClick:()=>F(a),className:"w-10 h-10 flex items-center justify-center bg-green-100 text-green-600 rounded-full",children:e.jsx(Fe,{size:18})}),e.jsx("button",{onClick:()=>v({loanId:a.loanId,installmentId:a.id,clientName:a.clientName,clientPhone:a.clientPhone,number:a.number,date:a.date,amount:a.payment}),className:"px-5 py-2 bg-green-500 hover:bg-green-600 text-white font-bold rounded-xl shadow active:scale-95 transition-transform",children:"Cobrar"})]})]})]},`${a.loanId}-${a.id}`))})]}):z==="historial"?e.jsxs("div",{className:"px-4",children:[e.jsxs("h2",{className:"text-sm font-bold text-slate-700 dark:text-slate-300 mb-3 flex items-center gap-2",children:["âœ… Cobros de Hoy",e.jsx("span",{className:"bg-emerald-100 text-emerald-600 text-xs px-2 py-0.5 rounded-full",children:A.length})]}),A.length===0?e.jsxs(B,{className:"p-8 text-center",children:[e.jsx(le,{className:"w-12 h-12 text-slate-400 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"No hay cobros registrados hoy"})]}):e.jsxs("div",{className:"space-y-3",children:[A.map((a,m)=>e.jsx(B,{className:"p-4 border-l-4 border-emerald-500",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-slate-900 dark:text-white",children:a.clientName}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Cuota #",a.number]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold text-emerald-600",children:W(a.amount)}),e.jsx("p",{className:"text-[10px] text-slate-500",children:re(a.date)})]})]})},m)),e.jsx(B,{className:"p-4 bg-emerald-50 dark:bg-emerald-900/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-bold text-emerald-700 dark:text-emerald-400",children:"Total Cobrado"}),e.jsx("p",{className:"text-xl font-bold text-emerald-600",children:W(A.reduce((a,m)=>a+(m.amount||0),0))})]})})]})]}):null,p&&e.jsx(Ve,{paymentToConfirm:p,onConfirm:H,onCancel:()=>v(null)}),h&&e.jsx(Ue,{receipt:h,companyName:"RenKredit",onClose:()=>P(null),onPrint:()=>{ot({id:h.id,date:h.date||new Date,clientName:h.clientName,clientPhone:h.clientPhone,amount:h.amount,penaltyAmount:h.penalty||0,installmentNumber:h.number,remainingBalance:h.remainingBalance},{companyName:"RenKredit"})}}),M&&e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"w-full max-w-sm bg-white dark:bg-slate-800 rounded-2xl shadow-2xl p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-white mb-4",children:"ðŸ“ Registrar Gasto"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"CategorÃ­a"}),e.jsxs("select",{value:k.category,onChange:a=>C({...k,category:a.target.value}),className:"w-full p-3 border rounded-xl bg-slate-50 dark:bg-slate-700",children:[e.jsx("option",{value:"",children:"Seleccionar..."}),e.jsx("option",{value:"FUEL",children:"â›½ Gasolina"}),e.jsx("option",{value:"FOOD",children:"ðŸ” Comida"}),e.jsx("option",{value:"TRANSPORT",children:"ðŸšŒ Transporte"}),e.jsx("option",{value:"PHONE",children:"ðŸ“± TelÃ©fono"}),e.jsx("option",{value:"OTHER",children:"ðŸ“¦ Otro"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Monto"}),e.jsx("input",{type:"number",value:k.amount,onChange:a=>C({...k,amount:a.target.value}),className:"w-full p-3 border rounded-xl bg-slate-50 dark:bg-slate-700 text-lg font-bold",placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"DescripciÃ³n"}),e.jsx("input",{type:"text",value:k.description,onChange:a=>C({...k,description:a.target.value}),className:"w-full p-3 border rounded-xl bg-slate-50 dark:bg-slate-700",placeholder:"Opcional..."})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>S(!1),className:"flex-1 py-3 border rounded-xl",children:"Cancelar"}),e.jsx("button",{onClick:q,disabled:!k.category||!k.amount,className:"flex-1 py-3 bg-indigo-500 text-white font-bold rounded-xl disabled:opacity-50",children:"Guardar"})]})]})}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-white dark:bg-slate-800 border-t border-slate-200 dark:border-slate-700 px-6 py-3 flex justify-around z-40",children:[e.jsxs("button",{onClick:()=>O("cobros"),className:`flex flex-col items-center gap-1 ${z==="cobros"?"text-indigo-600":"text-slate-400"}`,children:[e.jsx(se,{size:20}),e.jsx("span",{className:"text-[10px] font-medium",children:"Cobros"})]}),e.jsxs("button",{onClick:()=>S(!0),className:"flex flex-col items-center gap-1 text-slate-400",children:[e.jsx(xe,{size:20}),e.jsx("span",{className:"text-[10px] font-medium",children:"Gastos"})]}),e.jsxs("button",{onClick:()=>O("historial"),className:`flex flex-col items-center gap-1 ${z==="historial"?"text-indigo-600":"text-slate-400"}`,children:[e.jsx(le,{size:20}),e.jsx("span",{className:"text-[10px] font-medium",children:"Historial"})]})]})]})}function $t({onLogin:t,onSwitchToUserLogin:c}){const[i,r]=n.useState({tenantSlug:"",username:"",password:""}),[o,g]=n.useState(!1),[x,N]=n.useState(!1),[u,y]=n.useState(""),p=async v=>{if(v.preventDefault(),y(""),!i.tenantSlug||!i.username||!i.password){y("Todos los campos son requeridos");return}try{N(!0);const h=await fetch("/api/collectors/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tenantSlug:i.tenantSlug.toLowerCase().trim(),username:i.username.toLowerCase().trim(),password:i.password})}),P=await h.json();if(!h.ok){y(P.error||"Error en login");return}localStorage.setItem("collectorToken",P.token),localStorage.setItem("collectorData",JSON.stringify(P.collector)),localStorage.setItem("collectorTenant",JSON.stringify(P.tenant)),localStorage.setItem("mustChangePassword",P.mustChangePassword),t(P)}catch(h){console.error("Login error:",h),y("Error de conexiÃ³n")}finally{N(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-indigo-900 to-slate-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 bg-indigo-500/20 rounded-2xl flex items-center justify-center mx-auto mb-4 backdrop-blur-sm",children:e.jsx(ne,{className:"w-10 h-10 text-indigo-400"})}),e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Portal Cobrador"}),e.jsx("p",{className:"text-indigo-300 text-sm",children:"PRESTA PRO by RENACE.TECH"})]}),e.jsxs("form",{onSubmit:p,className:"bg-white/10 backdrop-blur-md rounded-2xl p-6 shadow-2xl",children:[u&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-500/20 border border-red-500/30 rounded-lg mb-4",children:[e.jsx(Be,{className:"w-5 h-5 text-red-400"}),e.jsx("span",{className:"text-red-200 text-sm",children:u})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-indigo-200 mb-1",children:"Empresa"}),e.jsxs("div",{className:"relative",children:[e.jsx(_e,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:"text",value:i.tenantSlug,onChange:v=>r({...i,tenantSlug:v.target.value}),className:"w-full pl-10 pr-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-slate-400 focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"codigo-empresa"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-indigo-200 mb-1",children:"Usuario"}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:"text",value:i.username,onChange:v=>r({...i,username:v.target.value}),className:"w-full pl-10 pr-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-slate-400 focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"tu.usuario"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-indigo-200 mb-1",children:"ContraseÃ±a"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),e.jsx("input",{type:o?"text":"password",value:i.password,onChange:v=>r({...i,password:v.target.value}),className:"w-full pl-10 pr-12 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-slate-400 focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"}),e.jsx("button",{type:"button",onClick:()=>g(!o),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-white",children:o?e.jsx(oe,{size:20}):e.jsx(ie,{size:20})})]})]})]}),e.jsx("button",{type:"submit",disabled:x,className:"w-full mt-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-lg transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:x?e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(He,{size:20}),"Ingresar"]})}),e.jsx("button",{type:"button",onClick:c,className:"w-full mt-3 py-2 text-indigo-300 hover:text-white text-sm transition-colors",children:"Â¿Eres administrador? Inicia sesiÃ³n aquÃ­"})]}),e.jsxs("p",{className:"text-center text-xs text-slate-500 mt-6",children:["Al iniciar sesiÃ³n aceptas nuestra"," ",e.jsx("a",{href:"/privacy",className:"text-indigo-400 hover:underline",children:"PolÃ­tica de Privacidad"})]})]})})}function Dt({collectorId:t,onClose:c,onSuccess:i,showToast:r}){const[o,g]=n.useState(""),[x,N]=n.useState(""),[u,y]=n.useState(""),[p,v]=n.useState(!1),[h,P]=n.useState(!1),[z,O]=n.useState(!1),[M,S]=n.useState(""),k=async C=>{if(C.preventDefault(),S(""),!o||!x||!u){S("Todos los campos son requeridos");return}if(x.length<6){S("La nueva contraseÃ±a debe tener al menos 6 caracteres");return}if(x!==u){S("Las contraseÃ±as no coinciden");return}try{O(!0);const A=localStorage.getItem("collectorToken"),L=await fetch("/api/collectors/change-password",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${A}`},body:JSON.stringify({collectorId:t,currentPassword:o,newPassword:x})}),_=await L.json();if(!L.ok){S(_.error||"Error al cambiar contraseÃ±a");return}r==null||r("âœ… ContraseÃ±a actualizada correctamente","success"),i==null||i(),c()}catch(A){console.error("Change password error:",A),S("Error de conexiÃ³n")}finally{O(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"w-full max-w-sm bg-white dark:bg-slate-800 rounded-2xl shadow-2xl overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-indigo-600 to-purple-600 px-6 py-4 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(K,{className:"w-5 h-5"}),e.jsx("h3",{className:"font-bold",children:"Cambiar ContraseÃ±a"})]}),e.jsx("button",{onClick:c,className:"p-1 hover:bg-white/20 rounded-full",children:e.jsx(Ee,{size:20})})]})}),e.jsxs("form",{onSubmit:k,className:"p-6 space-y-4",children:[M&&e.jsx("div",{className:"p-3 bg-red-100 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-lg text-red-700 dark:text-red-300 text-sm",children:M}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"ContraseÃ±a actual"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:p?"text":"password",value:o,onChange:C=>g(C.target.value),className:"w-full px-4 py-3 bg-slate-100 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-xl text-slate-900 dark:text-white",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"}),e.jsx("button",{type:"button",onClick:()=>v(!p),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400",children:p?e.jsx(oe,{size:18}):e.jsx(ie,{size:18})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Nueva contraseÃ±a"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:h?"text":"password",value:x,onChange:C=>N(C.target.value),className:"w-full px-4 py-3 bg-slate-100 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-xl text-slate-900 dark:text-white",placeholder:"MÃ­nimo 6 caracteres"}),e.jsx("button",{type:"button",onClick:()=>P(!h),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400",children:h?e.jsx(oe,{size:18}):e.jsx(ie,{size:18})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Confirmar contraseÃ±a"}),e.jsx("input",{type:"password",value:u,onChange:C=>y(C.target.value),className:"w-full px-4 py-3 bg-slate-100 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-xl text-slate-900 dark:text-white",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"})]}),e.jsx("button",{type:"submit",disabled:z,className:"w-full py-3 bg-green-500 hover:bg-green-600 text-white font-bold rounded-xl shadow-lg disabled:opacity-50 flex items-center justify-center gap-2",children:z?e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{size:18}),"Guardar ContraseÃ±a"]})})]})]})})}export{Dt as ChangePasswordModal,Lt as CollectorDashboard,$t as CollectorLoginView,zt as CollectorsView,I as collectorService};
